!function(){var e={5601:function(e,t,n){"use strict";var r=n(5861),a=n(7762),o=n(5671),i=n(3144),s=n(6296),c=n(7757),u=n.n(c),l=n(7557),d=n(866),h=n.n(d),f=function(){function e(t){(0,o.Z)(this,e),this.db=void 0,this.db=(0,l.X3)(t,1,{upgrade:function(e,t,n,r){var o,i=e.objectStoreNames,s=(0,a.Z)(i);try{for(s.s();!(o=s.n()).done;){var c=o.value;e.deleteObjectStore(c)}}catch(l){s.e(l)}finally{s.f()}var u=e.createObjectStore("changes",{keyPath:"hash"});u.createIndex("docId","docId",{unique:!1}),u.createIndex("timestamp","timestamp",{unique:!1});e.createObjectStore("snapshots",{keyPath:"docId"})}})}return(0,i.Z)(e,[{key:"storeChange",value:function(){var e=(0,r.Z)(u().mark((function e(t,n,r){var a,o,i,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db;case 2:return a=e.sent,o=a.transaction("changes","readwrite"),i=o.objectStore("changes"),e.next=7,i.get(n);case 7:if(!e.sent){e.next=9;break}return e.abrupt("return");case 9:return r.buffer.byteLength!==r.byteLength&&((s=new Uint8Array(r.byteLength)).set(r),r=s),e.next=12,a.add("changes",{docId:t,hash:n,change:r,timestamp:Date.now()});case 12:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getChanges",value:function(){var e=(0,r.Z)(u().mark((function e(t){var n,r,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=IDBKeyRange.only(t),e.next=3,this.db;case 3:return r=e.sent,e.next=6,r.getAllFromIndex("changes","docId",n);case 6:return a=e.sent,e.abrupt("return",a.map((function(e){return e.change})));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDoc",value:function(){var e=(0,r.Z)(u().mark((function e(t){var n,r,a,o,i,c,l,d,f,v,y,g,b,m,I,w,k,O;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db;case 2:return n=e.sent,e.next=5,n.get("snapshots",t);case 5:r=e.sent,a=IDBKeyRange.only(t),o=[],i=0,c=!1,l=!1,e.prev=11,f=(0,s.Z)(n.transaction("changes").store.index("docId").iterate(a));case 13:return e.next=15,f.next();case 15:if(!(c=!(v=e.sent).done)){e.next=22;break}y=v.value,o.push(y.value.change),i=Math.max(y.value.timestamp,i);case 19:c=!1,e.next=13;break;case 22:e.next=28;break;case 24:e.prev=24,e.t0=e.catch(11),l=!0,d=e.t0;case 28:if(e.prev=28,e.prev=29,!c||null==f.return){e.next=33;break}return e.next=33,f.return();case 33:if(e.prev=33,!l){e.next=36;break}throw d;case 36:return e.finish(33);case 37:return e.finish(28);case 38:for(g=new Map,b=new Map,m=0,I=o;m<I.length;m++)w=I[m],k=h().decodeChange(w),b.set(k.hash,w),g.set(w,k);return O=p(o,(function(e){return g.get(e).deps.map((function(e){return b.get(e)}))})),e.abrupt("return",{serializedDoc:null===r||void 0===r?void 0:r.serializedDoc,changes:O,lastChangeTime:i});case 43:case"end":return e.stop()}}),e,this,[[11,24,28,38],[29,,33,37]])})));return function(t){return e.apply(this,arguments)}}()},{key:"saveSnapshot",value:function(){var e=(0,r.Z)(u().mark((function e(t){var n,r,a,o,i,s,c,l,d,f;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getDoc(t);case 2:if(n=e.sent,r=n.serializedDoc,a=n.changes,o=n.lastChangeTime,!(a.length<100)){e.next=8;break}return e.abrupt("return");case 8:return i=r?h().load(r):h().init(),i=h().applyChanges(i,a)[0],s=h().save(i),e.next=13,this.db;case 13:return c=e.sent,e.next=16,c.put("snapshots",{docId:t,serializedDoc:s,timestamp:Date.now()});case 16:return l=IDBKeyRange.upperBound(o),d=c.transaction("changes","readwrite").store.index("timestamp"),e.next=20,d.openCursor(l);case 20:f=e.sent;case 21:if(!f){e.next=28;break}return f.delete(),e.next=25,f.continue();case 25:f=e.sent,e.next=21;break;case 28:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function p(e,t){for(var n=[],r=!0,o=new Set(e),i=new Set;o.size;){if(s(o.values().next().value),!r)throw new Error("Not a DAG")}return n;function s(e){if(o.has(e))if(i.has(e))r=!1;else{i.add(e);var c,u=(0,a.Z)(t(e));try{for(u.s();!(c=u.n()).done;){s(c.value)}}catch(l){u.e(l)}finally{u.f()}i.delete(e),o.delete(e),n.push(e)}}}var v=new f("autowiki");self.addEventListener("connect",(function(e){e.ports[0].onmessage=function(e){var t=e.data.docId;v.saveSnapshot(t)}}))},3014:function(e,t,n){var r=n(3269).default,a=n(9713).default,o=n(8504).encodeChange,i=n(8428).BackendDoc,s=n(8577).backendState;function c(e,t,n){if(e.hashesByActor[t]&&e.hashesByActor[t][n])return e.hashesByActor[t][n];if(!e.haveHashGraph&&(e.computeHashGraph(),e.hashesByActor[t]&&e.hashesByActor[t][n]))return e.hashesByActor[t][n];throw new RangeError("Unknown change: actorId = ".concat(t,", seq = ").concat(n+1))}function u(e,t){if(!Array.isArray(t))throw new TypeError("Pass an array of hashes to Backend.getChanges()");return s(e).getChanges(t)}e.exports={init:function(){return{state:new i,heads:[]}},clone:function(e){return{state:s(e).clone(),heads:e.heads}},free:function(e){e.state=null,e.frozen=!0},applyChanges:function(e,t){var n=s(e),r=n.applyChanges(t);return e.frozen=!0,[{state:n,heads:n.heads},r]},applyLocalChange:function(e,t){var n=s(e);if(t.seq<=n.clock[t.actor])throw new RangeError("Change request has already been applied");if(t.seq>1){var i=c(n,t.actor,t.seq-2);if(!i)throw new RangeError("Cannot find hash of localChange before seq=".concat(t.seq));var u,l=a({},i,!0),d=r(t.deps);try{for(d.s();!(u=d.n()).done;){l[u.value]=!0}}catch(v){d.e(v)}finally{d.f()}t.deps=Object.keys(l).sort()}var h=o(t),f=n.applyChanges([h],!0);e.frozen=!0;var p=c(n,t.actor,t.seq-1);return f.deps=f.deps.filter((function(e){return e!==p})),[{state:n,heads:n.heads},f,h]},save:function(e){return s(e).save()},load:function(e){var t=new i(e);return{state:t,heads:t.heads}},loadChanges:function(e,t){var n=s(e);return n.applyChanges(t),e.frozen=!0,{state:n,heads:n.heads}},getPatch:function(e){return s(e).getPatch()},getHeads:function(e){return e.heads},getAllChanges:function(e){return u(e,[])},getChanges:u,getChangesAdded:function(e,t){return s(t).getChangesAdded(s(e))},getChangeByHash:function(e,t){return s(e).getChangeByHash(t)},getMissingDeps:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return s(e).getMissingDeps(t)}}},8504:function(e,t,n){var r=n(3038).default,a=n(3269).default,o=n(2159),i=n(4443),s=i.copyObject,c=i.parseOpId,u=i.equalBytes,l=n(656),d=l.utf8ToString,h=l.hexStringToBytes,f=l.bytesToHexString,p=l.Encoder,v=l.Decoder,y=l.RLEEncoder,g=l.RLEDecoder,b=l.DeltaEncoder,m=l.DeltaDecoder,I=l.BooleanEncoder,w=l.BooleanDecoder,k=n(790).Hash,O=new Uint8Array([133,111,74,131]),E={GROUP_CARD:0,ACTOR_ID:1,INT_RLE:2,INT_DELTA:3,BOOLEAN:4,STRING_RLE:5,VALUE_LEN:6,VALUE_RAW:7},x={NULL:0,FALSE:1,TRUE:2,LEB128_UINT:3,LEB128_INT:4,IEEE754:5,UTF8:6,BYTES:7,COUNTER:8,TIMESTAMP:9,MIN_UNKNOWN:10,MAX_UNKNOWN:15},j=["makeMap","set","makeList","del","makeText","inc","makeTable","link"],A=[{columnName:"objActor",columnId:0|E.ACTOR_ID},{columnName:"objCtr",columnId:0|E.INT_RLE},{columnName:"keyActor",columnId:16|E.ACTOR_ID},{columnName:"keyCtr",columnId:16|E.INT_DELTA},{columnName:"keyStr",columnId:16|E.STRING_RLE},{columnName:"idActor",columnId:32|E.ACTOR_ID},{columnName:"idCtr",columnId:32|E.INT_DELTA},{columnName:"insert",columnId:48|E.BOOLEAN},{columnName:"action",columnId:64|E.INT_RLE},{columnName:"valLen",columnId:80|E.VALUE_LEN},{columnName:"valRaw",columnId:80|E.VALUE_RAW},{columnName:"chldActor",columnId:96|E.ACTOR_ID},{columnName:"chldCtr",columnId:96|E.INT_DELTA}],C=A.concat([{columnName:"predNum",columnId:112|E.GROUP_CARD},{columnName:"predActor",columnId:112|E.ACTOR_ID},{columnName:"predCtr",columnId:112|E.INT_DELTA}]),V=A.concat([{columnName:"succNum",columnId:128|E.GROUP_CARD},{columnName:"succActor",columnId:128|E.ACTOR_ID},{columnName:"succCtr",columnId:128|E.INT_DELTA}]),R=[{columnName:"actor",columnId:0|E.ACTOR_ID},{columnName:"seq",columnId:0|E.INT_DELTA},{columnName:"maxOp",columnId:16|E.INT_DELTA},{columnName:"time",columnId:32|E.INT_DELTA},{columnName:"message",columnId:48|E.STRING_RLE},{columnName:"depsNum",columnId:64|E.GROUP_CARD},{columnName:"depsIndex",columnId:64|E.INT_DELTA},{columnName:"extraLen",columnId:80|E.VALUE_LEN},{columnName:"extraRaw",columnId:80|E.VALUE_RAW}];function N(e,t){if(!e||!e.actorId)return e;var n=e.counter,r=t.indexOf(e.actorId);if(r<0)throw new RangeError("missing actorId");return{counter:n,actorNum:r,actorId:e.actorId}}function S(e,t){return e.counter<t.counter?-1:e.counter>t.counter?1:e.actorId<t.actorId?-1:e.actorId>t.actorId?1:0}function T(e,t){if("_root"===e.obj)t.objActor.appendValue(null),t.objCtr.appendValue(null);else{if(!(e.obj.actorNum>=0&&e.obj.counter>0))throw new RangeError("Unexpected objectId reference: ".concat(JSON.stringify(e.obj)));t.objActor.appendValue(e.obj.actorNum),t.objCtr.appendValue(e.obj.counter)}}function B(e,t){if(e.key)t.keyActor.appendValue(null),t.keyCtr.appendValue(null),t.keyStr.appendValue(e.key);else if("_head"===e.elemId&&e.insert)t.keyActor.appendValue(null),t.keyCtr.appendValue(0),t.keyStr.appendValue(null);else{if(!(e.elemId&&e.elemId.actorNum>=0&&e.elemId.counter>0))throw new RangeError("Unexpected operation key: ".concat(JSON.stringify(e)));t.keyActor.appendValue(e.elemId.actorNum),t.keyCtr.appendValue(e.elemId.counter),t.keyStr.appendValue(null)}}function L(e,t){var n=j.indexOf(e.action);if(n>=0)t.action.appendValue(n);else{if("number"!==typeof e.action)throw new RangeError("Unexpected operation action: ".concat(e.action));t.action.appendValue(e.action)}}function _(e,t){if("set"!==e.action&&"inc"!==e.action||null===e.value)t.valLen.appendValue(x.NULL);else if(!1===e.value)t.valLen.appendValue(x.FALSE);else if(!0===e.value)t.valLen.appendValue(x.TRUE);else if("string"===typeof e.value){var n=t.valRaw.appendRawString(e.value);t.valLen.appendValue(n<<4|x.UTF8)}else if(ArrayBuffer.isView(e.value)){var a=t.valRaw.appendRawBytes(new Uint8Array(e.value.buffer));t.valLen.appendValue(a<<4|x.BYTES)}else if("number"===typeof e.value){var o,i=function(e){switch(e.datatype){case"counter":return[x.COUNTER,e.value];case"timestamp":return[x.TIMESTAMP,e.value];case"uint":return[x.LEB128_UINT,e.value];case"int":return[x.LEB128_INT,e.value];case"float64":var t=new ArrayBuffer(8);return new DataView(t).setFloat64(0,e.value,!0),[x.IEEE754,new Uint8Array(t)];default:if(Number.isInteger(e.value)&&e.value<=Number.MAX_SAFE_INTEGER&&e.value>=Number.MIN_SAFE_INTEGER)return[x.LEB128_INT,e.value];var n=new ArrayBuffer(8);return new DataView(n).setFloat64(0,e.value,!0),[x.IEEE754,new Uint8Array(n)]}}(e),s=r(i,2),c=s[0],u=s[1];o=c===x.LEB128_UINT?t.valRaw.appendUint53(u):c===x.IEEE754?t.valRaw.appendRawBytes(u):t.valRaw.appendInt53(u),t.valLen.appendValue(o<<4|c)}else{if(!("number"===typeof e.datatype&&e.datatype>=x.MIN_UNKNOWN&&e.datatype<=x.MAX_UNKNOWN&&e.value instanceof Uint8Array))throw e.datatype?new RangeError("Unknown datatype ".concat(e.datatype," for value ").concat(e.value)):new RangeError("Unsupported value in operation: ".concat(e.value));var l=t.valRaw.appendRawBytes(e.value);t.valLen.appendValue(l<<4|e.datatype)}}function U(e,t){if(e===x.NULL)return{value:null};if(e===x.FALSE)return{value:!1};if(e===x.TRUE)return{value:!0};if(e%16===x.UTF8)return{value:d(t)};if(e%16===x.LEB128_UINT)return{value:new v(t).readUint53(),datatype:"uint"};if(e%16===x.LEB128_INT)return{value:new v(t).readInt53(),datatype:"int"};if(e%16===x.IEEE754){var n=new DataView(t.buffer,t.byteOffset,t.byteLength);if(8===t.byteLength)return{value:n.getFloat64(0,!0),datatype:"float64"};throw new RangeError("Invalid length for floating point number: ".concat(t.byteLength))}return e%16===x.COUNTER?{value:new v(t).readInt53(),datatype:"counter"}:e%16===x.TIMESTAMP?{value:new v(t).readInt53(),datatype:"timestamp"}:{value:t,datatype:e%16}}function H(e,t,n,r){var a=e[t],o=a.columnId,i=a.columnName,s=a.decoder;if(o%8===E.VALUE_LEN&&t+1<e.length&&e[t+1].columnId===o+1){var c=s.readValue(),u=U(c,e[t+1].decoder.readRawBytes(c>>4)),l=u.value,d=u.datatype;return r[i]=l,d&&(r[i+"_datatype"]=d),2}if(o%8===E.ACTOR_ID){var h=s.readValue();if(null===h)r[i]=null;else{if(!n[h])throw new RangeError("No actor index ".concat(h));r[i]=n[h]}}else r[i]=s.readValue();return 1}function D(e,t){return void 0===t?"string"===typeof e||"boolean"===typeof e||null===e:"number"===typeof e}function M(e,t,n){var r,o=t,i=[],s=a(e);try{for(s.s();!(r=s.n()).done;){var u=r.value;if("set"===u.action&&u.values&&u.insert){if(0!==u.pred.length)throw new RangeError("multi-insert pred must be empty");var l,d=u.elemId,h=u.datatype,f=a(u.values);try{for(f.s();!(l=f.n()).done;){var p=l.value;if(!D(p,h))throw new RangeError("Decode failed: bad value/datatype association (".concat(p,",").concat(h,")"));i.push({action:"set",obj:u.obj,elemId:d,datatype:h,value:p,pred:[],insert:!0}),d="".concat(o,"@").concat(n),o+=1}}catch(I){f.e(I)}finally{f.f()}}else if("del"===u.action&&u.multiOp>1){if(1!==u.pred.length)throw new RangeError("multiOp deletion must have exactly one pred");for(var v=c(u.elemId),y=c(u.pred[0]),g=0;g<u.multiOp;g++){var b="".concat(v.counter+g,"@").concat(v.actorId),m=["".concat(y.counter+g,"@").concat(y.actorId)];i.push({action:"del",obj:u.obj,elemId:b,pred:m}),o+=1}}else i.push(u),o+=1}}catch(I){s.e(I)}finally{s.f()}return i}function P(e,t){var n,r=[],o=a(e);try{for(o.s();!(n=o.n()).done;){var i=n.value,s=null===i.objCtr?"_root":"".concat(i.objCtr,"@").concat(i.objActor),c=i.keyStr?void 0:0===i.keyCtr?"_head":"".concat(i.keyCtr,"@").concat(i.keyActor),u=j[i.action]||i.action,l=c?{obj:s,elemId:c,action:u}:{obj:s,key:i.keyStr,action:u};if(l.insert=!!i.insert,"set"!==j[i.action]&&"inc"!==j[i.action]||(l.value=i.valLen,i.valLen_datatype&&(l.datatype=i.valLen_datatype)),!!i.chldCtr!==!!i.chldActor)throw new RangeError("Mismatched child columns: ".concat(i.chldCtr," and ").concat(i.chldActor));null!==i.chldCtr&&(l.child="".concat(i.chldCtr,"@").concat(i.chldActor)),t?(l.id="".concat(i.idCtr,"@").concat(i.idActor),l.succ=i.succNum.map((function(e){return"".concat(e.succCtr,"@").concat(e.succActor)})),q(i.succNum.map((function(e){return{counter:e.succCtr,actorId:e.succActor}})))):(l.pred=i.predNum.map((function(e){return"".concat(e.predCtr,"@").concat(e.predActor)})),q(i.predNum.map((function(e){return{counter:e.predCtr,actorId:e.predActor}})))),r.push(l)}}catch(d){o.e(d)}finally{o.f()}return r}function q(e){var t,n=null,r=a(e);try{for(r.s();!(t=r.n()).done;){var o=t.value;if(n&&-1!==S(n,o))throw new RangeError("operation IDs are not in ascending order");n=o}}catch(i){r.e(i)}finally{r.f()}}function F(e,t){return(7&e)===E.INT_DELTA?new m(t):(7&e)===E.BOOLEAN?new w(t):(7&e)===E.STRING_RLE?new g("utf8",t):(7&e)===E.VALUE_RAW?new v(t):new g("uint",t)}function G(e,t){for(var n=new Uint8Array(0),r=[],a=0,o=0;a<e.length||o<t.length;)if(a===e.length||o<t.length&&t[o].columnId<e[a].columnId){var i=t[o],s=i.columnId,c=i.columnName;r.push({columnId:s,columnName:c,decoder:F(s,n)}),o++}else if(o===t.length||e[a].columnId<t[o].columnId){var u=e[a],l=u.columnId,d=u.buffer;r.push({columnId:l,decoder:F(l,d)}),a++}else{var h=e[a],f=h.columnId,p=h.buffer,v=t[o].columnName;r.push({columnId:f,columnName:v,decoder:F(f,p)}),a++,o++}return r}function z(e,t,n){e=G(e,n);for(var r=[];e.some((function(e){return!e.decoder.done}));){for(var a={},o=0;o<e.length;){for(var i=e[o].columnId,s=i>>4,c=1;o+c<e.length&&e[o+c].columnId>>4===s;)c++;if(i%8===E.GROUP_CARD){for(var u=[],l=e[o].decoder.readValue(),d=0;d<l;d++){for(var h={},f=1;f<c;f++)H(e,o+f,t,h);u.push(h)}a[e[o].columnName]=u,o+=c}else o+=H(e,o,t,a)}r.push(a)}return r}function K(e){for(var t=-9>>>0,n=-1,r=[],a=e.readUint53(),o=0;o<a;o++){var i=e.readUint53(),s=e.readUint53();if((i&t)<=(n&t))throw new RangeError("Columns must be in ascending order");n=i,r.push({columnId:i,bufferLen:s})}return r}function W(e,t){var n=t.filter((function(e){return e.encoder.buffer.byteLength>0}));e.appendUint53(n.length);var r,o=a(n);try{for(o.s();!(r=o.n()).done;){var i=r.value;e.appendUint53(i.columnId),e.appendUint53(i.encoder.buffer.byteLength)}}catch(s){o.e(s)}finally{o.f()}}function J(e){for(var t=e.readUint53(),n=[],r=0;r<t;r++)n.push(f(e.readRawBytes(32)));for(var a={actor:e.readHexString(),seq:e.readUint53(),startOp:e.readUint53(),time:e.readInt53(),message:e.readPrefixedString(),deps:n},o=[a.actor],i=e.readUint53(),s=0;s<i;s++)o.push(e.readHexString());return a.actorIds=o,a}function Z(e,t){var n=O.byteLength+4+1+5,r=new p;r.appendRawBytes(new Uint8Array(n)),t(r);var a=r.buffer,o=new p;o.appendByte(e),o.appendUint53(a.byteLength-n);var i=o.buffer,s=new k;s.update(i),s.update(a.subarray(n));var c=s.digest(),u=c.subarray(0,4);return a.set(O,n-i.byteLength-4-O.byteLength),a.set(u,n-i.byteLength-4),a.set(i,n-i.byteLength),{hash:c,bytes:a.subarray(n-i.byteLength-4-O.byteLength)}}function X(e,t){if(!u(e.readRawBytes(O.byteLength),O))throw new RangeError("Data does not begin with magic bytes 85 6f 4a 83");var n=e.readRawBytes(4),r=e.offset,a=e.readByte(),o=e.readUint53(),i={chunkType:a,chunkLength:o,chunkData:e.readRawBytes(o)};if(t){var s=new k;s.update(e.buf.subarray(r,e.offset));var c=s.digest();if(!u(c.subarray(0,4),n))throw new RangeError("checksum does not match data");i.hash=f(c)}return i}function Y(e){if(Q.has(e))return Q.get(e);var t=function(e,t){var n,r={},o=[],i=a(e);try{for(i.s();!(n=i.n()).done;){var u=n.value;u=s(u),r[u.actor]=!0,u.ops=M(u.ops,u.startOp,u.actor),u.ops=u.ops.map((function(e){"_root"!==(e=s(e)).obj&&(e.obj=c(e.obj)),e.elemId&&"_head"!==e.elemId&&(e.elemId=c(e.elemId)),e.child&&(e.child=c(e.child)),e.pred&&(e.pred=e.pred.map(c)),e.obj.actorId&&(r[e.obj.actorId]=!0),e.elemId&&e.elemId.actorId&&(r[e.elemId.actorId]=!0),e.child&&e.child.actorId&&(r[e.child.actorId]=!0);var t,n=a(e.pred);try{for(n.s();!(t=n.n()).done;){var o=t.value;r[o.actorId]=!0}}catch(i){n.e(i)}finally{n.f()}return e})),o.push(u)}}catch(y){i.e(y)}finally{i.f()}var l=Object.keys(r).sort();t&&(l=[e[0].actor].concat(l.filter((function(t){return t!==e[0].actor}))));for(var d=0,h=o;d<h.length;d++){var f=h[d];f.actorNum=l.indexOf(f.actor);for(var p=0;p<f.ops.length;p++){var v=f.ops[p];v.id={counter:f.startOp+p,actorNum:f.actorNum,actorId:f.actor},v.obj=N(v.obj,l),v.elemId=N(v.elemId,l),v.child=N(v.child,l),v.pred=v.pred.map((function(e){return N(e,l)}))}}return{changes:o,actorIds:l}}([e],!0),n=t.changes,r=t.actorIds,i=n[0],u=Z(1,(function(e){if(!Array.isArray(i.deps))throw new TypeError("deps is not an array");e.appendUint53(i.deps.length);var t,n=a(i.deps.slice().sort());try{for(n.s();!(t=n.n()).done;){var o=t.value;e.appendRawBytes(h(o))}}catch(g){n.e(g)}finally{n.f()}e.appendHexString(i.actor),e.appendUint53(i.seq),e.appendUint53(i.startOp),e.appendInt53(i.time),e.appendPrefixedString(i.message||""),e.appendUint53(r.length-1);var s,c=a(r.slice(1));try{for(c.s();!(s=c.n()).done;){var u=s.value;e.appendHexString(u)}}catch(g){c.e(g)}finally{c.f()}var l=function(e,t){var n={objActor:new y("uint"),objCtr:new y("uint"),keyActor:new y("uint"),keyCtr:new b,keyStr:new y("utf8"),insert:new I,action:new y("uint"),valLen:new y("uint"),valRaw:new p,chldActor:new y("uint"),chldCtr:new b};t?(n.idActor=new y("uint"),n.idCtr=new b,n.succNum=new y("uint"),n.succActor=new y("uint"),n.succCtr=new b):(n.predNum=new y("uint"),n.predCtr=new b,n.predActor=new y("uint"));var r,o=a(e);try{for(o.s();!(r=o.n()).done;){var i=r.value;if(T(i,n),B(i,n),n.insert.appendValue(!!i.insert),L(i,n),_(i,n),i.child&&i.child.counter?(n.chldActor.appendValue(i.child.actorNum),n.chldCtr.appendValue(i.child.counter)):(n.chldActor.appendValue(null),n.chldCtr.appendValue(null)),t){n.idActor.appendValue(i.id.actorNum),n.idCtr.appendValue(i.id.counter),n.succNum.appendValue(i.succ.length),i.succ.sort(S);for(var s=0;s<i.succ.length;s++)n.succActor.appendValue(i.succ[s].actorNum),n.succCtr.appendValue(i.succ[s].counter)}else{n.predNum.appendValue(i.pred.length),i.pred.sort(S);for(var c=0;c<i.pred.length;c++)n.predActor.appendValue(i.pred[c].actorNum),n.predCtr.appendValue(i.pred[c].counter)}}}catch(g){o.e(g)}finally{o.f()}var u,l=[],d=a(t?V:C);try{for(d.s();!(u=d.n()).done;){var h=u.value,f=h.columnName,v=h.columnId;n[f]&&l.push({columnId:v,columnName:f,encoder:n[f]})}}catch(g){d.e(g)}finally{d.f()}return l.sort((function(e,t){return e.columnId-t.columnId}))}(i.ops,!1);W(e,l);var d,f=a(l);try{for(f.s();!(d=f.n()).done;){var v=d.value;e.appendRawBytes(v.encoder.buffer)}}catch(g){f.e(g)}finally{f.f()}i.extraBytes&&e.appendRawBytes(i.extraBytes)})),l=u.hash,d=u.bytes,g=f(l);if(e.hash&&e.hash!==g)throw new RangeError("Change hash does not match encoding: ".concat(e.hash," != ").concat(g));return d.byteLength>=256?function(e){var t=X(new v(e),!1);if(1!==t.chunkType)throw new RangeError("Unexpected chunk type: ".concat(t.chunkType));var n=o.deflateRaw(t.chunkData),r=new p;return r.appendRawBytes(e.subarray(0,8)),r.appendByte(2),r.appendUint53(n.byteLength),r.appendRawBytes(n),r.buffer}(d):d}function $(e){2===e[8]&&(e=te(e));var t=new v(e),n=X(t,!0),r=new v(n.chunkData);if(!t.done)throw new RangeError("Encoded change has trailing data");if(1!==n.chunkType)throw new RangeError("Unexpected chunk type: ".concat(n.chunkType));for(var a=J(r),o=K(r),i=0;i<o.length;i++){if(0!==(8&o[i].columnId))throw new RangeError("change must not contain deflated columns");o[i].buffer=r.readRawBytes(o[i].bufferLen)}if(!r.done){var s=r.buf.byteLength-r.offset;a.extraBytes=r.readRawBytes(s)}return a.columns=o,a.hash=n.hash,a}var Q=new WeakMap;function ee(e){var t=$(e);return t.ops=P(z(t.columns,t.actorIds,C),!1),delete t.actorIds,delete t.columns,Q.set(t,e),t}function te(e){var t=X(new v(e),!1);if(2!==t.chunkType)throw new RangeError("Unexpected chunk type: ".concat(t.chunkType));var n=o.inflateRaw(t.chunkData),r=new p;return r.appendRawBytes(e.subarray(0,8)),r.appendByte(1),r.appendUint53(n.byteLength),r.appendRawBytes(n),r.buffer}function ne(e){for(var t=new v(e),n=[],r=0;!t.done;)X(t,!1),n.push(e.subarray(r,t.offset)),r=t.offset;return n}function re(e,t){if(e===t)return 0;if("_root"===e)return-1;if("_root"===t)return 1;var n=c(e),r=c(t);return n.counter<r.counter?-1:n.counter>r.counter?1:n.actorId<r.actorId?-1:n.actorId>r.actorId?1:0}function ae(e){var t=new v(e),n=X(t,!0),r=new v(n.chunkData);if(!t.done)throw new RangeError("Encoded document has trailing data");if(0!==n.chunkType)throw new RangeError("Unexpected chunk type: ".concat(n.chunkType));for(var a=[],o=r.readUint53(),i=0;i<o;i++)a.push(r.readHexString());for(var s=[],c=[],u=r.readUint53(),l=0;l<u;l++)s.push(f(r.readRawBytes(32)));for(var d=K(r),h=K(r),p=0;p<d.length;p++)d[p].buffer=r.readRawBytes(d[p].bufferLen),se(d[p]);for(var y=0;y<h.length;y++)h[y].buffer=r.readRawBytes(h[y].bufferLen),se(h[y]);if(!r.done)for(var g=0;g<u;g++)c.push(r.readUint53());return{changesColumns:d,opsColumns:h,actorIds:a,heads:s,headsIndexes:c,extraBytes:r.readRawBytes(r.buf.byteLength-r.offset)}}function oe(e){var t=ae(e),n=t.changesColumns,r=t.opsColumns,o=t.actorIds,i=t.heads,s=z(n,o,R);return function(e,t){var n,r={},o=a(e);try{for(o.s();!(n=o.n()).done;){var i=n.value;if(i.ops=[],r[i.actor]||(r[i.actor]=[]),i.seq!==r[i.actor].length+1)throw new RangeError("Expected seq = ".concat(r[i.actor].length+1,", got ").concat(i.seq));if(i.seq>1&&r[i.actor][i.seq-2].maxOp>i.maxOp)throw new RangeError("maxOp must increase monotonically per actor");r[i.actor].push(i)}}catch(B){o.e(B)}finally{o.f()}var s,u={},l=a(t);try{for(l.s();!(s=l.n()).done;){var d=s.value;if("del"===d.action)throw new RangeError("document should not contain del operations");d.pred=u[d.id]?u[d.id].pred:[],u[d.id]=d;var h,f=a(d.succ);try{for(f.s();!(h=f.n()).done;){var p=h.value;if(!u[p])if(d.elemId){var v=d.insert?d.id:d.elemId;u[p]={id:p,action:"del",obj:d.obj,elemId:v,pred:[]}}else u[p]={id:p,action:"del",obj:d.obj,key:d.key,pred:[]};u[p].pred.push(d.id)}}catch(B){f.e(B)}finally{f.f()}delete d.succ}}catch(B){l.e(B)}finally{l.f()}for(var y=0,g=Object.values(u);y<g.length;y++){var b=g[y];"del"===b.action&&t.push(b)}var m,I=a(t);try{for(I.s();!(m=I.n()).done;){for(var w=m.value,k=c(w.id),O=k.counter,E=r[k.actorId],x=0,j=E.length;x<j;){var A=Math.floor((x+j)/2);E[A].maxOp<O?x=A+1:j=A}if(x>=E.length)throw new RangeError("Operation ID ".concat(w.id," outside of allowed range"));E[x].ops.push(w)}}catch(B){I.e(B)}finally{I.f()}var C,V=a(e);try{for(V.s();!(C=V.n()).done;){var R=C.value;R.ops.sort((function(e,t){return re(e.id,t.id)})),R.startOp=R.maxOp-R.ops.length+1,delete R.maxOp;for(var N=0;N<R.ops.length;N++){var S=R.ops[N],T="".concat(R.startOp+N,"@").concat(R.actor);if(S.id!==T)throw new RangeError("Expected opId ".concat(T,", got ").concat(S.id));delete S.id}}}catch(B){V.e(B)}finally{V.f()}}(s,P(z(r,o,V),!0)),function(e,t){for(var n={},r=0;r<e.length;r++){var o=e[r];o.deps=[];var i,s=a(o.depsNum.map((function(e){return e.depsIndex})));try{for(s.s();!(i=s.n()).done;){var c=i.value;if(!e[c]||!e[c].hash)throw new RangeError("No hash for index ".concat(c," while processing index ").concat(r));var u=e[c].hash;o.deps.push(u),n[u]&&delete n[u]}}catch(f){s.e(f)}finally{s.f()}if(o.deps.sort(),delete o.depsNum,o.extraLen_datatype!==x.BYTES)throw new RangeError("Bad datatype for extra bytes: ".concat(x.BYTES));o.extraBytes=o.extraLen,delete o.extraLen_datatype,e[r]=ee(Y(o)),n[e[r].hash]=!0}for(var l=Object.keys(n).sort(),d=l.length===t.length,h=0;d&&h<l.length;)d=l[h]===t[h],h++;if(!d)throw new RangeError("Mismatched heads hashes: expected ".concat(t.join(", "),", got ").concat(l.join(", ")))}(s,i),s}function ie(e){e.encoder.buffer.byteLength>=256&&(e.encoder={buffer:o.deflateRaw(e.encoder.buffer)},e.columnId|=8)}function se(e){0!==(8&e.columnId)&&(e.buffer=o.inflateRaw(e.buffer),e.columnId^=8)}e.exports={COLUMN_TYPE:E,VALUE_TYPE:x,ACTIONS:j,OBJECT_TYPE:{makeMap:"map",makeList:"list",makeText:"text",makeTable:"table"},DOC_OPS_COLUMNS:V,CHANGE_COLUMNS:C,DOCUMENT_COLUMNS:R,encoderByColumnId:function(e){return(7&e)===E.INT_DELTA?new b:(7&e)===E.BOOLEAN?new I:(7&e)===E.STRING_RLE?new y("utf8"):(7&e)===E.VALUE_RAW?new p:new y("uint")},decoderByColumnId:F,makeDecoders:G,decodeValue:U,splitContainers:ne,encodeChange:Y,decodeChangeColumns:$,decodeChange:ee,decodeChangeMeta:function(e,t){2===e[8]&&(e=te(e));var n=X(new v(e),t);if(1!==n.chunkType)throw new RangeError("Buffer chunk type is not a change");var r=J(new v(n.chunkData));return r.change=e,t&&(r.hash=n.hash),r},decodeChanges:function(e){var t,n=[],r=a(e);try{for(r.s();!(t=r.n()).done;){var o,i=t.value,s=a(ne(i));try{for(s.s();!(o=s.n()).done;){var c=o.value;0===c[8]?n=n.concat(oe(c)):1!==c[8]&&2!==c[8]||n.push(ee(c))}}catch(u){s.e(u)}finally{s.f()}}}catch(u){r.e(u)}finally{r.f()}return n},encodeDocumentHeader:function(e){var t,n=e.changesColumns,r=e.opsColumns,o=e.actorIds,i=e.heads,s=e.headsIndexes,c=e.extraBytes,u=a(n);try{for(u.s();!(t=u.n()).done;){ie(t.value)}}catch(f){u.e(f)}finally{u.f()}var l,d=a(r);try{for(d.s();!(l=d.n()).done;){ie(l.value)}}catch(f){d.e(f)}finally{d.f()}return Z(0,(function(e){e.appendUint53(o.length);var t,u=a(o);try{for(u.s();!(t=u.n()).done;){var l=t.value;e.appendHexString(l)}}catch(f){u.e(f)}finally{u.f()}e.appendUint53(i.length);var d,p=a(i.sort());try{for(p.s();!(d=p.n()).done;){var v=d.value;e.appendRawBytes(h(v))}}catch(f){p.e(f)}finally{p.f()}W(e,n),W(e,r);var y,g=a(n);try{for(g.s();!(y=g.n()).done;){var b=y.value;e.appendRawBytes(b.encoder.buffer)}}catch(f){g.e(f)}finally{g.f()}var m,I=a(r);try{for(I.s();!(m=I.n()).done;){var w=m.value;e.appendRawBytes(w.encoder.buffer)}}catch(f){I.e(f)}finally{I.f()}var k,O=a(s);try{for(O.s();!(k=O.n()).done;){var E=k.value;e.appendUint53(E)}}catch(f){O.e(f)}finally{O.f()}c&&e.appendRawBytes(c)})).bytes},decodeDocumentHeader:ae,decodeDocument:oe}},656:function(e,t,n){var r=n(6525).default,a=n(9754).default,o=n(3269).default,i=n(2205).default,s=n(9842).default,c=n(4575).default,u=n(3913).default,l=new TextEncoder,d=new TextDecoder("utf-8");function h(e){return l.encode(e)}function f(e){return d.decode(e)}function p(e){if("string"!==typeof e)throw new TypeError("value is not a string");if(!/^([0-9a-f][0-9a-f])*$/.test(e))throw new RangeError("value is not hexadecimal");return""===e?new Uint8Array(0):new Uint8Array(e.match(/../g).map((function(e){return parseInt(e,16)})))}for(var v=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],y=new Array(256),g=0;g<256;g++)y[g]="".concat(v[g>>>4&15]).concat(v[15&g]);function b(e){for(var t="",n=e.byteLength,r=0;r<n;r++)t+=y[e[r]];return t}var m=function(){"use strict";function e(){c(this,e),this.buf=new Uint8Array(16),this.offset=0}return u(e,[{key:"buffer",get:function(){return this.finish(),this.buf.subarray(0,this.offset)}},{key:"grow",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=4*this.buf.byteLength;t<e;)t*=2;var n=new Uint8Array(t);return n.set(this.buf,0),this.buf=n,this}},{key:"appendByte",value:function(e){this.offset>=this.buf.byteLength&&this.grow(),this.buf[this.offset]=e,this.offset+=1}},{key:"appendUint32",value:function(e){if(!Number.isInteger(e))throw new RangeError("value is not an integer");if(e<0||e>4294967295)throw new RangeError("number out of range");var t=Math.max(1,Math.ceil((32-Math.clz32(e))/7));this.offset+t>this.buf.byteLength&&this.grow();for(var n=0;n<t;n++)this.buf[this.offset+n]=127&e|(n===t-1?0:128),e>>>=7;return this.offset+=t,t}},{key:"appendInt32",value:function(e){if(!Number.isInteger(e))throw new RangeError("value is not an integer");if(e<-2147483648||e>2147483647)throw new RangeError("number out of range");var t=Math.ceil((33-Math.clz32(e>=0?e:-e-1))/7);this.offset+t>this.buf.byteLength&&this.grow();for(var n=0;n<t;n++)this.buf[this.offset+n]=127&e|(n===t-1?0:128),e>>=7;return this.offset+=t,t}},{key:"appendUint53",value:function(e){if(!Number.isInteger(e))throw new RangeError("value is not an integer");if(e<0||e>Number.MAX_SAFE_INTEGER)throw new RangeError("number out of range");var t=Math.floor(e/4294967296),n=(4294967295&e)>>>0;return this.appendUint64(t,n)}},{key:"appendInt53",value:function(e){if(!Number.isInteger(e))throw new RangeError("value is not an integer");if(e<Number.MIN_SAFE_INTEGER||e>Number.MAX_SAFE_INTEGER)throw new RangeError("number out of range");var t=Math.floor(e/4294967296),n=(4294967295&e)>>>0;return this.appendInt64(t,n)}},{key:"appendUint64",value:function(e,t){if(!Number.isInteger(e)||!Number.isInteger(t))throw new RangeError("value is not an integer");if(e<0||e>4294967295||t<0||t>4294967295)throw new RangeError("number out of range");if(0===e)return this.appendUint32(t);var n=Math.ceil((64-Math.clz32(e))/7);this.offset+n>this.buf.byteLength&&this.grow();for(var r=0;r<4;r++)this.buf[this.offset+r]=127&t|128,t>>>=7;this.buf[this.offset+4]=15&t|(7&e)<<4|(5===n?0:128),e>>>=3;for(var a=5;a<n;a++)this.buf[this.offset+a]=127&e|(a===n-1?0:128),e>>>=7;return this.offset+=n,n}},{key:"appendInt64",value:function(e,t){if(!Number.isInteger(e)||!Number.isInteger(t))throw new RangeError("value is not an integer");if(e<-2147483648||e>2147483647||t<-2147483648||t>4294967295)throw new RangeError("number out of range");if(t>>>=0,0===e&&t<=2147483647)return this.appendInt32(t);if(-1===e&&t>=2147483648)return this.appendInt32(t-4294967296);var n=Math.ceil((65-Math.clz32(e>=0?e:-e-1))/7);this.offset+n>this.buf.byteLength&&this.grow();for(var r=0;r<4;r++)this.buf[this.offset+r]=127&t|128,t>>>=7;this.buf[this.offset+4]=15&t|(7&e)<<4|(5===n?0:128),e>>=3;for(var a=5;a<n;a++)this.buf[this.offset+a]=127&e|(a===n-1?0:128),e>>=7;return this.offset+=n,n}},{key:"appendRawBytes",value:function(e){return this.offset+e.byteLength>this.buf.byteLength&&this.grow(this.offset+e.byteLength),this.buf.set(e,this.offset),this.offset+=e.byteLength,e.byteLength}},{key:"appendRawString",value:function(e){if("string"!==typeof e)throw new TypeError("value is not a string");return this.appendRawBytes(h(e))}},{key:"appendPrefixedBytes",value:function(e){return this.appendUint53(e.byteLength),this.appendRawBytes(e),this}},{key:"appendPrefixedString",value:function(e){if("string"!==typeof e)throw new TypeError("value is not a string");return this.appendPrefixedBytes(h(e)),this}},{key:"appendHexString",value:function(e){return this.appendPrefixedBytes(p(e)),this}},{key:"finish",value:function(){}}]),e}(),I=function(){"use strict";function e(t){if(c(this,e),!(t instanceof Uint8Array))throw new TypeError("Not a byte array: ".concat(t));this.buf=t,this.offset=0}return u(e,[{key:"done",get:function(){return this.offset===this.buf.byteLength}},{key:"reset",value:function(){this.offset=0}},{key:"skip",value:function(e){if(this.offset+e>this.buf.byteLength)throw new RangeError("cannot skip beyond end of buffer");this.offset+=e}},{key:"readByte",value:function(){return this.offset+=1,this.buf[this.offset-1]}},{key:"readUint32",value:function(){for(var e=0,t=0;this.offset<this.buf.byteLength;){var n=this.buf[this.offset];if(28===t&&0!==(240&n))throw new RangeError("number out of range");if(e=(e|(127&n)<<t)>>>0,t+=7,this.offset++,0===(128&n))return e}throw new RangeError("buffer ended with incomplete number")}},{key:"readInt32",value:function(){for(var e=0,t=0;this.offset<this.buf.byteLength;){var n=this.buf[this.offset];if(28===t&&0!==(128&n)||28===t&&0===(64&n)&&0!==(56&n)||28===t&&0!==(64&n)&&56!==(56&n))throw new RangeError("number out of range");if(e|=(127&n)<<t,t+=7,this.offset++,0===(128&n))return 0===(64&n)||t>28?e:e|-1<<t}throw new RangeError("buffer ended with incomplete number")}},{key:"readUint53",value:function(){var e=this.readUint64(),t=e.low32,n=e.high32;if(n<0||n>2097151)throw new RangeError("number out of range");return 4294967296*n+t}},{key:"readInt53",value:function(){var e=this.readInt64(),t=e.low32,n=e.high32;if(n<-2097152||-2097152===n&&0===t||n>2097151)throw new RangeError("number out of range");return 4294967296*n+t}},{key:"readUint64",value:function(){for(var e=0,t=0,n=0;this.offset<this.buf.byteLength&&n<=28;){var r=this.buf[this.offset];if(e=(e|(127&r)<<n)>>>0,28===n&&(t=(112&r)>>>4),n+=7,this.offset++,0===(128&r))return{high32:t,low32:e}}for(n=3;this.offset<this.buf.byteLength;){var a=this.buf[this.offset];if(31===n&&0!==(254&a))throw new RangeError("number out of range");if(t=(t|(127&a)<<n)>>>0,n+=7,this.offset++,0===(128&a))return{high32:t,low32:e}}throw new RangeError("buffer ended with incomplete number")}},{key:"readInt64",value:function(){for(var e=0,t=0,n=0;this.offset<this.buf.byteLength&&n<=28;){var r=this.buf[this.offset];if(e=(e|(127&r)<<n)>>>0,28===n&&(t=(112&r)>>>4),n+=7,this.offset++,0===(128&r))return 0!==(64&r)&&(n<32&&(e=(e|-1<<n)>>>0),t|=-1<<Math.max(n-32,0)),{high32:t,low32:e}}for(n=3;this.offset<this.buf.byteLength;){var a=this.buf[this.offset];if(31===n&&0!==a&&127!==a)throw new RangeError("number out of range");if(t|=(127&a)<<n,n+=7,this.offset++,0===(128&a))return 0!==(64&a)&&n<32&&(t|=-1<<n),{high32:t,low32:e}}throw new RangeError("buffer ended with incomplete number")}},{key:"readRawBytes",value:function(e){var t=this.offset;if(t+e>this.buf.byteLength)throw new RangeError("subarray exceeds buffer size");return this.offset+=e,this.buf.subarray(t,this.offset)}},{key:"readRawString",value:function(e){return f(this.readRawBytes(e))}},{key:"readPrefixedBytes",value:function(){return this.readRawBytes(this.readUint53())}},{key:"readPrefixedString",value:function(){return f(this.readPrefixedBytes())}},{key:"readHexString",value:function(){return b(this.readPrefixedBytes())}}]),e}(),w=function(e){"use strict";i(n,e);var t=s(n);function n(e){var r;return c(this,n),(r=t.call(this)).type=e,r.state="empty",r.lastValue=void 0,r.count=0,r.literal=[],r}return u(n,[{key:"appendValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this._appendValue(e,t)}},{key:"_appendValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;t<=0||("empty"===this.state?(this.state=null===e?"nulls":1===t?"loneValue":"repetition",this.lastValue=e,this.count=t):"loneValue"===this.state?null===e?(this.flush(),this.state="nulls",this.count=t):e===this.lastValue?(this.state="repetition",this.count=1+t):t>1?(this.flush(),this.state="repetition",this.count=t,this.lastValue=e):(this.state="literal",this.literal=[this.lastValue],this.lastValue=e):"repetition"===this.state?null===e?(this.flush(),this.state="nulls",this.count=t):e===this.lastValue?this.count+=t:t>1?(this.flush(),this.state="repetition",this.count=t,this.lastValue=e):(this.flush(),this.state="loneValue",this.lastValue=e):"literal"===this.state?null===e?(this.literal.push(this.lastValue),this.flush(),this.state="nulls",this.count=t):e===this.lastValue?(this.flush(),this.state="repetition",this.count=1+t):t>1?(this.literal.push(this.lastValue),this.flush(),this.state="repetition",this.count=t,this.lastValue=e):(this.literal.push(this.lastValue),this.lastValue=e):"nulls"===this.state&&(null===e?this.count+=t:t>1?(this.flush(),this.state="repetition",this.count=t,this.lastValue=e):(this.flush(),this.state="loneValue",this.lastValue=e)))}},{key:"copyFrom",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.count,r=t.sumValues,a=t.sumShift;if(!(e instanceof k)||e.type!==this.type)throw new TypeError("incompatible type of decoder");var o="number"===typeof n?n:Number.MAX_SAFE_INTEGER,i=0,s=0;if(n&&o>0&&e.done)throw new RangeError("cannot copy ".concat(n," values"));if(0===o||e.done)return r?{nonNullValues:i,sum:s}:{nonNullValues:i};var c=e.readValue();if(null===c){var u=Math.min(e.count+1,o);if(o-=u,e.count-=u-1,this.appendValue(null,u),n&&o>0&&e.done)throw new RangeError("cannot copy ".concat(n," values"));if(0===o||e.done)return r?{nonNullValues:i,sum:s}:{nonNullValues:i};if(null===(c=e.readValue()))throw new RangeError("null run must be followed by non-null value")}if(this.appendValue(c),o--,i++,r&&(s+=a?c>>>a:c),n&&o>0&&e.done)throw new RangeError("cannot copy ".concat(n," values"));if(0===o||e.done)return r?{nonNullValues:i,sum:s}:{nonNullValues:i};for(var l=e.count>0;o>0&&!e.done;){l||e.readRecord();var d=Math.min(e.count,o);if(e.count-=d,"literal"===e.state){i+=d;for(var h=0;h<d;h++){if(e.done)throw new RangeError("incomplete literal");var f=e.readRawValue();if(f===e.lastValue)throw new RangeError("Repetition of values is not allowed in literal");e.lastValue=f,this._appendValue(f),r&&(s+=a?f>>>a:f)}}else if("repetition"===e.state){i+=d,r&&(s+=d*(a?e.lastValue>>>a:e.lastValue));var p=e.lastValue;if(this._appendValue(p),d>1){if(this._appendValue(p),"repetition"!==this.state)throw new RangeError("Unexpected state ".concat(this.state));this.count+=d-2}}else if("nulls"===e.state){if(this._appendValue(null),"nulls"!==this.state)throw new RangeError("Unexpected state ".concat(this.state));this.count+=d-1}l=!1,o-=d}if(n&&o>0&&e.done)throw new RangeError("cannot copy ".concat(n," values"));return r?{nonNullValues:i,sum:s}:{nonNullValues:i}}},{key:"flush",value:function(){if("loneValue"===this.state)this.appendInt32(-1),this.appendRawValue(this.lastValue);else if("repetition"===this.state)this.appendInt53(this.count),this.appendRawValue(this.lastValue);else if("literal"===this.state){this.appendInt53(-this.literal.length);var e,t=o(this.literal);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.appendRawValue(n)}}catch(r){t.e(r)}finally{t.f()}}else"nulls"===this.state&&(this.appendInt32(0),this.appendUint53(this.count));this.state="empty"}},{key:"appendRawValue",value:function(e){if("int"===this.type)this.appendInt53(e);else if("uint"===this.type)this.appendUint53(e);else{if("utf8"!==this.type)throw new RangeError("Unknown RLEEncoder datatype: ".concat(this.type));this.appendPrefixedString(e)}}},{key:"finish",value:function(){"literal"===this.state&&this.literal.push(this.lastValue),("nulls"!==this.state||this.offset>0)&&this.flush()}}]),n}(m),k=function(e){"use strict";i(n,e);var t=s(n);function n(e,r){var a;return c(this,n),(a=t.call(this,r)).type=e,a.lastValue=void 0,a.count=0,a.state=void 0,a}return u(n,[{key:"done",get:function(){return 0===this.count&&this.offset===this.buf.byteLength}},{key:"reset",value:function(){this.offset=0,this.lastValue=void 0,this.count=0,this.state=void 0}},{key:"readValue",value:function(){if(this.done)return null;if(0===this.count&&this.readRecord(),this.count-=1,"literal"===this.state){var e=this.readRawValue();if(e===this.lastValue)throw new RangeError("Repetition of values is not allowed in literal");return this.lastValue=e,e}return this.lastValue}},{key:"skipValues",value:function(e){for(;e>0&&!this.done;){0===this.count&&(this.count=this.readInt53(),this.count>0?(this.lastValue=this.count<=e?this.skipRawValues(1):this.readRawValue(),this.state="repetition"):this.count<0?(this.count=-this.count,this.state="literal"):(this.count=this.readUint53(),this.lastValue=null,this.state="nulls"));var t=Math.min(e,this.count);"literal"===this.state&&this.skipRawValues(t),e-=t,this.count-=t}}},{key:"readRecord",value:function(){if(this.count=this.readInt53(),this.count>1){var e=this.readRawValue();if(("repetition"===this.state||"literal"===this.state)&&this.lastValue===e)throw new RangeError("Successive repetitions with the same value are not allowed");this.state="repetition",this.lastValue=e}else{if(1===this.count)throw new RangeError("Repetition count of 1 is not allowed, use a literal instead");if(this.count<0){if(this.count=-this.count,"literal"===this.state)throw new RangeError("Successive literals are not allowed");this.state="literal"}else{if("nulls"===this.state)throw new RangeError("Successive null runs are not allowed");if(this.count=this.readUint53(),0===this.count)throw new RangeError("Zero-length null runs are not allowed");this.lastValue=null,this.state="nulls"}}}},{key:"readRawValue",value:function(){if("int"===this.type)return this.readInt53();if("uint"===this.type)return this.readUint53();if("utf8"===this.type)return this.readPrefixedString();throw new RangeError("Unknown RLEDecoder datatype: ".concat(this.type))}},{key:"skipRawValues",value:function(e){if("utf8"===this.type)for(var t=0;t<e;t++)this.skip(this.readUint53());else{for(;e>0&&this.offset<this.buf.byteLength;)0===(128&this.buf[this.offset])&&e--,this.offset++;if(e>0)throw new RangeError("cannot skip beyond end of buffer")}}}]),n}(I),O=function(e){"use strict";i(n,e);var t=s(n);function n(){var e;return c(this,n),(e=t.call(this,"int")).absoluteValue=0,e}return u(n,[{key:"appendValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;t<=0||("number"===typeof e?(r(a(n.prototype),"appendValue",this).call(this,e-this.absoluteValue,1),this.absoluteValue=e,t>1&&r(a(n.prototype),"appendValue",this).call(this,0,t-1)):r(a(n.prototype),"appendValue",this).call(this,e,t))}},{key:"copyFrom",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t.sumValues)throw new RangeError("unsupported options for DeltaEncoder.copyFrom()");if(!(e instanceof E))throw new TypeError("incompatible type of decoder");var o=t.count;if(o>0&&e.done)throw new RangeError("cannot copy ".concat(o," values"));if(0!==o&&!e.done){var i=e.readValue(),s=0;if(this.appendValue(i),null===i){if(s=e.count+1,void 0!==o&&o<s&&(s=o),e.count-=s-1,this.count+=s-1,o>s&&e.done)throw new RangeError("cannot copy ".concat(o," values"));if(o===s||e.done)return;0===e.count&&this.appendValue(e.readValue())}void 0!==o&&(o-=s+1);var c=r(a(n.prototype),"copyFrom",this).call(this,e,{count:o,sumValues:!0}),u=c.nonNullValues,l=c.sum;u>0&&(this.absoluteValue=l,e.absoluteValue=l)}}}]),n}(w),E=function(e){"use strict";i(n,e);var t=s(n);function n(e){var r;return c(this,n),(r=t.call(this,"int",e)).absoluteValue=0,r}return u(n,[{key:"reset",value:function(){this.offset=0,this.lastValue=void 0,this.count=0,this.state=void 0,this.absoluteValue=0}},{key:"readValue",value:function(){var e=r(a(n.prototype),"readValue",this).call(this);return null===e?null:(this.absoluteValue+=e,this.absoluteValue)}},{key:"skipValues",value:function(e){for(;e>0&&!this.done;){0===this.count&&this.readRecord();var t=Math.min(e,this.count);if("literal"===this.state)for(var n=0;n<t;n++)this.lastValue=this.readRawValue(),this.absoluteValue+=this.lastValue;else"repetition"===this.state&&(this.absoluteValue+=t*this.lastValue);e-=t,this.count-=t}}}]),n}(k),x=function(e){"use strict";i(n,e);var t=s(n);function n(){var e;return c(this,n),(e=t.call(this)).lastValue=!1,e.count=0,e}return u(n,[{key:"appendValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!1!==e&&!0!==e)throw new RangeError("Unsupported value for BooleanEncoder: ".concat(e));t<=0||(this.lastValue===e?this.count+=t:(this.appendUint53(this.count),this.lastValue=e,this.count=t))}},{key:"copyFrom",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(e instanceof j))throw new TypeError("incompatible type of decoder");var n=t.count,r="number"===typeof n?n:Number.MAX_SAFE_INTEGER;if(n&&r>0&&e.done)throw new RangeError("cannot copy ".concat(n," values"));if(0!==r&&!e.done){this.appendValue(e.readValue()),r--;var a=Math.min(e.count,r);for(this.count+=a,e.count-=a,r-=a;r>0&&!e.done;){if(e.count=e.readUint53(),0===e.count)throw new RangeError("Zero-length runs are not allowed");e.lastValue=!e.lastValue,this.appendUint53(this.count);var o=Math.min(e.count,r);this.count=o,this.lastValue=e.lastValue,e.count-=o,r-=o}if(n&&r>0&&e.done)throw new RangeError("cannot copy ".concat(n," values"))}}},{key:"finish",value:function(){this.count>0&&(this.appendUint53(this.count),this.count=0)}}]),n}(m),j=function(e){"use strict";i(n,e);var t=s(n);function n(e){var r;return c(this,n),(r=t.call(this,e)).lastValue=!0,r.firstRun=!0,r.count=0,r}return u(n,[{key:"done",get:function(){return 0===this.count&&this.offset===this.buf.byteLength}},{key:"reset",value:function(){this.offset=0,this.lastValue=!0,this.firstRun=!0,this.count=0}},{key:"readValue",value:function(){if(this.done)return!1;for(;0===this.count;){if(this.count=this.readUint53(),this.lastValue=!this.lastValue,0===this.count&&!this.firstRun)throw new RangeError("Zero-length runs are not allowed");this.firstRun=!1}return this.count-=1,this.lastValue}},{key:"skipValues",value:function(e){for(;e>0&&!this.done;){if(0===this.count){if(this.count=this.readUint53(),this.lastValue=!this.lastValue,0===this.count&&!this.firstRun)throw new RangeError("Zero-length runs are not allowed");this.firstRun=!1}this.count<e?(e-=this.count,this.count=0):(this.count-=e,e=0)}}}]),n}(I);e.exports={stringToUtf8:h,utf8ToString:f,hexStringToBytes:p,bytesToHexString:b,Encoder:m,Decoder:I,RLEEncoder:w,RLEDecoder:k,DeltaEncoder:O,DeltaDecoder:E,BooleanEncoder:x,BooleanDecoder:j}},5871:function(e,t,n){var r=n(3014),a=r.init,o=r.clone,i=r.free,s=r.applyChanges,c=r.applyLocalChange,u=r.save,l=r.load,d=r.loadChanges,h=r.getPatch,f=r.getHeads,p=r.getAllChanges,v=r.getChanges,y=r.getChangesAdded,g=r.getChangeByHash,b=r.getMissingDeps,m=n(7855),I=m.receiveSyncMessage,w=m.generateSyncMessage,k=m.encodeSyncMessage,O=m.decodeSyncMessage,E=m.encodeSyncState,x=m.decodeSyncState,j=m.initSyncState;e.exports={init:a,clone:o,free:i,applyChanges:s,applyLocalChange:c,save:u,load:l,loadChanges:d,getPatch:h,getHeads:f,getAllChanges:p,getChanges:v,getChangesAdded:y,getChangeByHash:g,getMissingDeps:b,receiveSyncMessage:I,generateSyncMessage:w,encodeSyncMessage:k,decodeSyncMessage:O,encodeSyncState:E,decodeSyncState:x,initSyncState:j}},8428:function(e,t,n){var r=n(4575).default,a=n(3913).default,o=n(319).default,i=n(3038).default,s=n(3269).default,c=n(4443),u=c.parseOpId,l=c.copyObject,d=n(8504),h=d.COLUMN_TYPE,f=d.VALUE_TYPE,p=d.ACTIONS,v=d.OBJECT_TYPE,y=d.DOC_OPS_COLUMNS,g=d.CHANGE_COLUMNS,b=d.DOCUMENT_COLUMNS,m=d.encoderByColumnId,I=d.decoderByColumnId,w=d.makeDecoders,k=d.decodeValue,O=d.encodeChange,E=d.decodeChangeColumns,x=d.decodeChangeMeta,j=d.decodeChanges,A=d.decodeDocumentHeader,C=d.encodeDocumentHeader,V=600,R=Math.floor(750),N=g.filter((function(e){return["predNum","predActor","predCtr"].includes(e.columnName)})).map((function(e){return e.columnId}));function S(e,t,n){if(1===t.length)e[t[0]]=n;else{var r=Object.assign({},e[t[0]]);S(r,t.slice(1),n),e[t[0]]=r}}function T(e,t,n,r){var a,o=s(t);try{for(o.s();!(a=o.n()).done;){a.value.decoder.reset()}}catch(U){o.e(U)}finally{o.f()}var c=e.objActor,u=e.objCtr,l=e.keyActor,d=e.keyCtr,h=e.keyStr,f=e.idActor,p=e.idCtr,v=e.insert,y=t.map((function(e){return e.decoder})),g=i(y,14),b=g[0],m=g[1],I=g[4],w=g[5],k=g[6],O=g[7],E=g[8],x=g[13],j=0,A=0,C=!1,V=null,R=null,N=null,S=null,T=null,B=null,L=0;if(null!==u&&!r)for(;(!m.done||!b.done||!E.done)&&(R=m.readValue(),V=n[b.readValue()],E.skipValues(1),null===R||!V||R<u||R===u&&V<c);)j+=1;if((R!==u||V!==c)&&!r)return{found:!0,skipCount:j,visibleCount:A};if(null!==h){for(I.skipValues(j);!I.done;){var _=b.readValue();if(V=null===_?null:n[_],R=m.readValue(),!(null!==(T=I.readValue())&&T<h&&R===u&&V===c))break;j+=1}return{found:!0,skipCount:j,visibleCount:A}}if(k.skipValues(j),w.skipValues(j),O.skipValues(j),x.skipValues(j),S=k.readValue(),N=n[w.readValue()],B=O.readValue(),L=x.readValue(),v){if(!r&&null!==d&&d>0&&null!==l){for(j+=1;!k.done&&!w.done&&(S!==d||N!==l)&&(B&&(C=!1),0!==L||C||(A+=1,C=!0),S=k.readValue(),N=n[w.readValue()],R=m.readValue(),V=n[b.readValue()],B=O.readValue(),L=x.readValue(),R===u&&V===c);)j+=1;if(R!==u||V!==c||S!==d||N!==l||!B)return{found:!1,skipCount:j,visibleCount:A};if(B&&(C=!1),0!==L||C||(A+=1,C=!0),k.done||w.done)return{found:!0,skipCount:j,visibleCount:A};S=k.readValue(),N=n[w.readValue()],R=m.readValue(),V=n[b.readValue()],B=O.readValue(),L=x.readValue()}for(;(!B||S>p||S===p&&N>f)&&R===u&&V===c&&(j+=1,B&&(C=!1),0!==L||C||(A+=1,C=!0),!k.done&&!w.done);)S=k.readValue(),N=n[w.readValue()],R=m.readValue(),V=n[b.readValue()],B=O.readValue(),L=x.readValue()}else if(null!==d&&d>0&&null!==l){for(;(!B||S!==d||N!==l)&&R===u&&V===c&&(j+=1,B&&(C=!1),0!==L||C||(A+=1,C=!0),!k.done&&!w.done);)S=k.readValue(),N=n[w.readValue()],R=m.readValue(),V=n[b.readValue()],B=O.readValue(),L=x.readValue();if(R!==u||V!==c||S!==d||N!==l||!B)return{found:!1,skipCount:j,visibleCount:A}}return{found:!0,skipCount:j,visibleCount:A}}function B(e,t,n,r){var a=e.blocks[t],o=e.blocks[t+1];return a.lastObjectActor!==n||a.lastObjectCtr!==r||void 0===a.numVisible?0:a.lastVisibleActor===o.firstVisibleActor&&void 0!==a.lastVisibleActor&&a.lastVisibleCtr===o.firstVisibleCtr&&void 0!==a.lastVisibleCtr?a.numVisible-1:a.numVisible}function L(e,t){var n=t.objActor,r=t.objActorNum,a=t.objCtr,o=t.keyActor,i=t.keyCtr,s=t.keyStr,c=0,u=0;if(null!==a)for(;c<e.blocks.length-1;){var l=void 0===e.blocks[c].lastObjectActor?void 0:e.actorIds[e.blocks[c].lastObjectActor],d=e.blocks[c].lastObjectCtr;if(!(null===d||d<a||d===a&&l<n))break;c++}if(null!==s){for(;c<e.blocks.length-1;){var h=e.blocks[c],f=h.lastObjectActor,p=h.lastObjectCtr,v=h.lastKey;if(!(a===p&&r===f&&void 0!==v&&v<s))break;c++}return{blockIndex:c,skipCount:T(t,e.blocks[c].columns,e.actorIds,!1).skipCount,visibleCount:0}}for(var y=null===i||0===i||null===o,g=null===o?null:e.actorIds.indexOf(o),b=!1;;){if(!y&&!b)for(;c<e.blocks.length-1&&e.blocks[c].lastObjectActor===r&&e.blocks[c].lastObjectCtr===a&&!U(e.blocks[c].bloom,g,i);){if(e.blocks[c].lastObjectCtr>a)throw new RangeError("Reference element not found: ".concat(i,"@").concat(o));u+=B(e,c,r,a),c++}var m=T(t,e.blocks[c].columns,e.actorIds,b),I=m.found,w=m.skipCount,k=m.visibleCount;if(c===e.blocks.length-1||e.blocks[c].lastObjectActor!==r||e.blocks[c].lastObjectCtr!==a){if(I)return{blockIndex:c,skipCount:w,visibleCount:u+k};throw new RangeError("Reference element not found: ".concat(i,"@").concat(o))}if(I&&w<e.blocks[c].numOps)return{blockIndex:c,skipCount:w,visibleCount:u+k};b=I&&t.insert,u+=B(e,c,r,a),c++}}function _(e,t,n){for(var r=8*e.byteLength,a=n%r,o=t%r,i=(16777619*(n^t)>>>0)%r,s=0;s<7;s++)e[a>>>3]|=1<<(7&a),a=(a+o)%r,o=(o+i)%r}function U(e,t,n){for(var r=8*e.byteLength,a=n%r,o=t%r,i=(16777619*(n^t)>>>0)%r,s=0;s<7;s++){if(0===(e[a>>>3]&1<<(7&a)))return!1;a=(a+o)%r,o=(o+i)%r}return!0}function H(e){e.bloom=new Uint8Array(R),e.numOps=0,e.lastKey=void 0,e.numVisible=void 0,e.lastObjectActor=void 0,e.lastObjectCtr=void 0,e.firstVisibleActor=void 0,e.firstVisibleCtr=void 0,e.lastVisibleActor=void 0,e.lastVisibleCtr=void 0;var t,n=s(e.columns);try{for(n.s();!(t=n.n()).done;){t.value.decoder.reset()}}catch(A){n.e(A)}finally{n.f()}for(var r=e.columns.map((function(e){return e.decoder})),a=i(r,14),o=a[0],c=a[1],u=a[2],l=a[3],d=a[4],h=a[5],f=a[6],p=a[7],v=a[13];!f.done;){e.numOps+=1;var y=o.readValue(),g=c.readValue(),b=u.readValue(),m=l.readValue(),I=d.readValue(),w=h.readValue(),k=f.readValue(),O=p.readValue(),E=v.readValue();if(e.lastObjectActor===y&&e.lastObjectCtr===g||(e.numVisible=0,e.lastObjectActor=y,e.lastObjectCtr=g),null!==I)e.lastKey=I;else if(O||null!==m){e.lastKey=void 0;var x=O?w:b,j=O?k:m;_(e.bloom,x,j),0===E&&(void 0===e.firstVisibleActor&&(e.firstVisibleActor=x),void 0===e.firstVisibleCtr&&(e.firstVisibleCtr=j),e.lastVisibleActor===x&&e.lastVisibleCtr===j||(e.numVisible+=1,e.lastVisibleActor=x,e.lastVisibleCtr=j))}}}function D(e,t,n,r){if(null!==t[4])e.lastObjectCtr===t[1]&&e.lastObjectActor===t[0]&&(void 0===e.lastKey||e.lastKey<t[4])&&(e.lastKey=t[4]);else{var a=t[7]?t[5]:t[2],o=t[7]?t[6]:t[3];_(e.bloom,a,o),(0===t[13]||r)&&(void 0===e.firstVisibleActor&&(e.firstVisibleActor=a),void 0===e.firstVisibleCtr&&(e.firstVisibleCtr=o),e.lastVisibleActor=a,e.lastVisibleCtr=o)}(void 0===e.lastObjectCtr||null!==t[0]&&null!==t[1]&&(null===e.lastObjectCtr||e.lastObjectCtr<t[1]||e.lastObjectCtr===t[1]&&n[e.lastObjectActor]<n[t[0]]))&&(e.lastObjectActor=t[0],e.lastObjectCtr=t[1],e.lastKey=null!==t[4]?t[4]:void 0,e.numVisible=0)}function M(e){var t,n=s(e.columns);try{for(n.s();!(t=n.n()).done;){t.value.decoder.reset()}}catch(h){n.e(h)}finally{n.f()}for(var r=Math.ceil(e.numOps/480),a=[],o=0,i=1;i<=r;i++){var c=Math.ceil(i*e.numOps/r)-o,u=e.columns.map((function(e){return{columnId:e.columnId,encoder:m(e.columnId)}}));q(u,e.columns,c);var l=u.map((function(e){var t=I(e.columnId,e.encoder.buffer);return{columnId:e.columnId,decoder:t}})),d={columns:l};H(d),a.push(d),o+=c}return a}function P(e){var t,n=e[0].columns.map((function(e){return{columnId:e.columnId,encoder:m(e.columnId)}})),r=s(e);try{for(r.s();!(t=r.n()).done;){var a,o=t.value,i=s(o.columns);try{for(i.s();!(a=i.n()).done;){a.value.decoder.reset()}}catch(c){i.e(c)}finally{i.f()}q(n,o.columns,o.numOps)}}catch(c){r.e(c)}finally{r.f()}return n}function q(e,t,n){if(0!==n){var r,a=0,o=-1,i=0,c=-1,u=0,l=s(e);try{for(l.s();!(r=l.n()).done;){for(var d=r.value;a<t.length&&t[a].columnId<d.columnId;)a++;var f=null;a<t.length&&t[a].columnId===d.columnId&&t[a].decoder.buf.byteLength>0&&(f=t[a].decoder);var p=d.columnId>>4===o?i:n;if(d.columnId%8===h.GROUP_CARD)o=d.columnId>>4,f?i=d.encoder.copyFrom(f,{count:n,sumValues:!0}).sum:(d.encoder.appendValue(0,n),i=0);else if(d.columnId%8===h.VALUE_LEN)if(f){if(a+1===t.length||t[a+1].columnId!==d.columnId+1)throw new RangeError("VALUE_LEN column without accompanying VALUE_RAW column");c=d.columnId+1,u=d.encoder.copyFrom(f,{count:p,sumValues:!0,sumShift:4}).sum}else d.encoder.appendValue(null,p),c=d.columnId+1,u=0;else if(d.columnId%8===h.VALUE_RAW){if(d.columnId!==c)throw new RangeError("VALUE_RAW column without accompanying VALUE_LEN column");u>0&&d.encoder.appendRawBytes(f.readRawBytes(u))}else if(f)d.encoder.copyFrom(f,{count:p});else{var v=d.columnId%8!==h.BOOLEAN&&null;d.encoder.appendValue(v,p)}}}catch(y){l.e(y)}finally{l.f()}}}function F(e,t){var n,r,a=[],o=-1,i=0,c=-1,u=0,l=s(e);try{for(l.s();!(r=l.n()).done;){var d=r.value;if(d.columnId%8===h.VALUE_RAW){if(d.columnId!==c)throw new RangeError("unexpected VALUE_RAW column");n=d.decoder.readRawBytes(u)}else if(d.columnId%8===h.GROUP_CARD)o=d.columnId>>4,n=i=d.decoder.readValue()||0;else if(d.columnId>>4===o){n=[],d.columnId%8===h.VALUE_LEN&&(c=d.columnId+1,u=0);for(var f=0;f<i;f++){var p=d.decoder.readValue();d.columnId%8===h.ACTOR_ID&&t&&"number"===typeof p&&(p=t[p]),d.columnId%8===h.VALUE_LEN&&(u+=n>>>4),n.push(p)}}else n=d.decoder.readValue(),d.columnId%8===h.ACTOR_ID&&t&&"number"===typeof n&&(n=t[n]),d.columnId%8===h.VALUE_LEN&&(c=d.columnId+1,u=n>>>4);a.push(n)}}catch(v){l.e(v)}finally{l.f()}return a}function G(e,t,n){var r,a=0,o=-1,i=0,c=s(e);try{for(c.s();!(r=c.n()).done;){for(var u=r.value;a<t.length&&t[a].columnId<u.columnId;)a++;if(a<t.length&&t[a].columnId===u.columnId){var l=n[a];if(u.columnId%8===h.GROUP_CARD)o=u.columnId>>4,i=l,u.encoder.appendValue(l);else if(u.columnId>>4===o){if(!Array.isArray(l)||l.length!==i)throw new RangeError("bad group value");var d,f=s(l);try{for(f.s();!(d=f.n()).done;){var p=d.value;u.encoder.appendValue(p)}}catch(g){f.e(g)}finally{f.f()}}else u.columnId%8===h.VALUE_RAW?l&&u.encoder.appendRawBytes(l):u.encoder.appendValue(l)}else if(u.columnId%8===h.GROUP_CARD)o=u.columnId>>4,i=0,u.encoder.appendValue(0);else if(u.columnId%8!==h.VALUE_RAW){var v=u.columnId>>4===o?i:1,y=null;u.columnId%8===h.BOOLEAN&&(y=!1),u.columnId%8===h.VALUE_LEN&&(y=0),u.encoder.appendValue(y,v)}}}catch(g){c.e(g)}finally{c.f()}}function z(e,t){var n=e.blocks[t];if(n.columns[8].decoder.done){if(t===e.blocks.length-1)return{docOp:null,blockIndex:t};t+=1,n=e.blocks[t];var r,a=s(n.columns);try{for(a.s();!(r=a.n()).done;){r.value.decoder.reset()}}catch(o){a.e(o)}finally{a.f()}return{docOp:F(n.columns),blockIndex:t}}return{docOp:F(n.columns),blockIndex:t}}function K(e,t){for(;t.changeIndex<t.changes.length-1&&(!t.columns||t.columns[8].decoder.done);){t.changeIndex+=1;var n=t.changes[t.changeIndex];t.columns=w(n.columns,g),t.opCtr=n.startOp,t.columns[8].decoder.done&&(n.maxOp=n.startOp-1),Q(e,t.columns);var r=ee(e.actorIds,n),a=r.actorIds,o=r.actorTable;e.actorIds=a,t.actorTable=o,t.actorIndex=e.actorIds.indexOf(n.actorIds[0])}if(t.columns[8].decoder.done)return t.done=!0,void(t.nextOp=null);t.nextOp=F(t.columns,t.actorTable),t.nextOp[5]=t.actorIndex,t.nextOp[6]=t.opCtr,t.changes[t.changeIndex].maxOp=t.opCtr,t.opCtr>e.maxOp&&(e.maxOp=t.opCtr),t.opCtr+=1;var i=t.nextOp;if(null===i[1]&&null!==i[0]||null!==i[1]&&null===i[0])throw new RangeError("Mismatched object reference: (".concat(i[1],", ").concat(i[0],")"));if(null===i[3]&&null!==i[2]||0===i[3]&&null!==i[2]||i[3]>0&&null===i[2])throw new RangeError("Mismatched operation key: (".concat(i[3],", ").concat(i[2],")"))}function W(e,t){return"list"===t||"text"===t?{objectId:e,type:t,edits:[]}:{objectId:e,type:t,props:{}}}function J(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=u(e),a=u(t);return r.actorId===a.actorId&&r.counter+n===a.counter}function Z(e,t){if(0!==e.length){var n=e[e.length-1];"insert"===n.action&&"insert"===t.action&&n.index===t.index-1&&"value"===n.value.type&&"value"===t.value.type&&n.elemId===n.opId&&t.elemId===t.opId&&J(n.elemId,t.elemId,1)&&n.value.datatype===t.value.datatype&&typeof n.value.value===typeof t.value.value?(n.action="multi-insert",t.value.datatype&&(n.datatype=t.value.datatype),n.values=[n.value.value,t.value.value],delete n.value,delete n.opId):"multi-insert"===n.action&&"insert"===t.action&&n.index+n.values.length===t.index&&"value"===t.value.type&&t.elemId===t.opId&&J(n.elemId,t.elemId,n.values.length)&&n.datatype===t.value.datatype&&typeof n.values[0]===typeof t.value.value?n.values.push(t.value.value):"remove"===n.action&&"remove"===t.action&&n.index===t.index?n.count+=t.count:e.push(t)}else e.push(t)}function X(e,t,n,r,a,o){var i=!1;if(o)for(;!i&&e.length>0;){var s=e[e.length-1];if("insert"!==s.action&&"update"!==s.action||s.index!==t){if("multi-insert"!==s.action||s.index+s.values.length-1!==t)break;s.values.pop(),i=!0}else e.pop(),i="insert"===s.action}Z(e,i?{action:"insert",index:t,elemId:n,opId:r,value:a}:{action:"update",index:t,opId:r,value:a})}function Y(e,t,n,r,a,o,i,c){var u=!t,l=r[8]<p.length?v[p[r[8]]]:null,d="".concat(r[6],"@").concat(a.actorIds[r[5]]),h=r[7]?r[5]:r[2],y=r[7]?r[6]:r[3],g=r[4]?r[4]:"".concat(y,"@").concat(a.actorIds[h]);r[8]%2!==0||a.objectMeta[d]||(a.objectMeta[d]={parentObj:n,parentKey:g,opId:d,type:l,children:{}},S(a.objectMeta,[n,"children",g,d],{objectId:d,type:l,props:{}}));var b=!o[g];o[g]||(o[g]={visibleOps:[],hasChild:!1});var m=void 0!==c&&r[13]>0;m||(o[g].visibleOps.push(r),o[g].hasChild=o[g].hasChild||r[8]%2===0);var I,w,O=a.objectMeta[n].children[g];if(o[g].hasChild||O&&Object.keys(O).length>0){var E,x={},j=s(o[g].visibleOps);try{for(j.s();!(E=j.n()).done;){var A=E.value,C="".concat(A[6],"@").concat(a.actorIds[A[5]]);if("set"===p[A[8]])x[C]=Object.assign({type:"value"},k(A[9],A[10]));else if(A[8]%2===0){var V=A[8]<p.length?v[p[A[8]]]:null;x[C]=W(C,V)}}}catch(H){j.e(H)}finally{j.f()}S(a.objectMeta,[n,"children",g],x)}if(m&&"set"===p[r[8]]&&(15&r[9])===f.COUNTER){o[g]||(o[g]={visibleOps:[],hasChild:!1}),o[g].counterStates||(o[g].counterStates={});for(var R=o[g].counterStates,N={opId:d,value:k(r[9],r[10]).value,succs:{}},T=0;T<r[13];T++){var B="".concat(r[15][T],"@").concat(a.actorIds[r[14][T]]);R[B]=N,N.succs[B]=!0}}else if("inc"===p[r[8]]){if(!o[g]||!o[g].counterStates||!o[g].counterStates[d])throw new RangeError("increment operation ".concat(d," for unknown counter"));var L=o[g].counterStates[d];L.value+=k(r[9],r[10]).value,delete L.succs[d],0===Object.keys(L.succs).length&&(I=L.opId,w={type:"value",datatype:"counter",value:L.value})}else m||("set"===p[r[8]]?(I=d,w=Object.assign({type:"value"},k(r[9],r[10]))):r[8]%2===0&&(e[d]||(e[d]=W(d,l)),I=d,w=e[d]));e[n]||(e[n]=W(n,a.objectMeta[n].type));var _=e[n];if(null===r[4])if(0!==c||u||"insert"!==o[g].action||(o[g].action="update",function(e,t,n){for(var r=[];e.length>0;){var a=e[e.length-1];if("insert"===a.action){if(a.index!==t)throw new RangeError("last edit has unexpected index");r.unshift(e.pop());break}if("update"!==a.action)throw new RangeError("last edit has unexpected action");if(a.index!==t)throw new RangeError("last edit has unexpected index");r.unshift(e.pop())}for(var o=!0,i=0,s=r;i<s.length;i++){var c=s[i];X(e,t,n,c.opId,c.value,o),o=!1}}(_.edits,i,g),t&&t.lastObjectActor===r[0]&&t.lastObjectCtr===r[1]&&(t.numVisible-=1)),w)if(o[g].action||void 0!==c&&!u)if("remove"===o[g].action){var U=_.edits[_.edits.length-1];if("remove"!==U.action)throw new RangeError("last edit has unexpected type");U.count>1?U.count-=1:_.edits.pop(),o[g].action="update",X(_.edits,i,g,I,w,!0),t&&t.lastObjectActor===r[0]&&t.lastObjectCtr===r[1]&&(t.numVisible+=1)}else X(_.edits,i,g,I,w,!o[g].action),o[g].action||(o[g].action="update");else o[g].action="insert",Z(_.edits,{action:"insert",index:i,elemId:g,opId:I,value:w}),t&&t.lastObjectActor===r[0]&&t.lastObjectCtr===r[1]&&(t.numVisible+=1);else 0!==c||o[g].action||(o[g].action="remove",Z(_.edits,{action:"remove",index:i,count:1}),t&&t.lastObjectActor===r[0]&&t.lastObjectCtr===r[1]&&(t.numVisible-=1));else!w&&u||(!b&&_.props[r[4]]||(_.props[r[4]]={}),w&&(_.props[r[4]][I]=w))}function $(e,t,n){var r,a=i(t.nextOp,8),c=a[0],u=a[1],l=a[2],d=a[3],h=a[4],f=a[5],v=a[6],y=a[7],g=null===c?null:n.actorIds[c],b=L(n,{objActor:g,objActorNum:c,objCtr:u,keyActor:null===l?null:n.actorIds[l],keyActorNum:l,keyCtr:d,keyStr:h,idActor:n.actorIds[f],idCtr:v,insert:y,objId:null===g?"_root":"".concat(u,"@").concat(g)}),w=b.blockIndex,k=b.skipCount,O=b.visibleCount,E=n.blocks[w],x=s(E.columns);try{for(x.s();!(r=x.n()).done;){r.value.decoder.reset()}}catch(J){x.e(J)}finally{x.f()}var j=0===k||void 0===E.firstVisibleActor||!y&&E.firstVisibleActor===l&&E.firstVisibleCtr===d,A={columns:void 0,bloom:new Uint8Array(E.bloom),numOps:k,lastKey:E.lastKey,numVisible:E.numVisible,lastObjectActor:E.lastObjectActor,lastObjectCtr:E.lastObjectCtr,firstVisibleActor:j?void 0:E.firstVisibleActor,firstVisibleCtr:j?void 0:E.firstVisibleCtr,lastVisibleActor:void 0,lastVisibleCtr:void 0},C=E.columns.map((function(e){return{columnId:e.columnId,encoder:m(e.columnId)}}));q(C,E.columns,k);for(var R=function(e,t,n,r,a,o,i){var c,u=r.nextOp,l=u[7],d=u[0],h=u[1],f=null===d?"_root":"".concat(h,"@").concat(a.actorIds[d]),v=r.actorIndex,y=a.actorIds[v],g=!1,b=!1,m={},I=z(a,i);c=I.docOp,i=I.blockIndex;var w=null===c?0:1,k=null===c?0:c[13],O=null,E=[],x=[],j=[],A=null;for(r.objectIds.add(f);;){if(0===E.length){g=!1;for(var C=r.nextOp;!r.done&&C[5]===v&&C[7]===l&&C[0]===u[0]&&C[1]===u[1];){for(var V=E.length>0?E[E.length-1]:null,R=!1,N=0;N<C[13];N++){var S,T=s(E);try{for(T.s();!(S=T.n()).done;){var B=S.value;C[14][N]===B[5]&&C[15][N]===B[6]&&(R=!0)}}catch(J){T.e(J)}finally{T.f()}}if(C===u);else if(l&&null!==V&&null===C[4]&&C[2]===V[5]&&C[3]===V[6]);else if((l||null===V||null===C[4]||C[4]!==V[4]||R)&&(l||null===V||null!==C[4]||null!==V[4]||C[2]!==V[2]||C[3]!==V[3]||R))if(!l&&null===V&&null===C[4]&&c&&c[7]&&null===c[4]&&c[5]===C[2]&&c[6]===C[3]);else if(l||null!==V||null===C[4]||null===A||!(A<C[4]))break;A=null!==C?C[4]:null,E.push(r.nextOp),x.push(r.columns),j.push(new Array(r.nextOp[13])),K(a,r),C=r.nextOp}}E.length>0&&(O=E[0]);var L=c&&c[0]===O[0]&&c[1]===O[1],_=c&&null!==c[4]&&c[4]===O[4],U=c&&null===c[4]&&null===O[4]&&(!c[7]&&c[2]===O[2]&&c[3]===O[3]||c[7]&&c[5]===O[2]&&c[6]===O[3]);if(0===E.length&&(!L||!_&&!U))break;var H=!1,M=0;if(l||!L||null===c[4]&&null!==O[4]||null!==c[4]&&null!==O[4]&&O[4]<c[4]){if(M=E.length,!L&&!g&&null===O[4]&&!O[7])throw new RangeError("could not find list element with ID: "+"".concat(O[3],"@").concat(a.actorIds[O[2]]))}else if(_||U||g){for(var P=0;P<E.length;P++)for(var q=E[P],F=0;F<q[13];F++)if(q[14][F]===c[5]&&q[15][F]===c[6]){for(var W=0;W<c[13]&&(c[15][W]<q[6]||c[15][W]===q[6]&&a.actorIds[c[14][W]]<y);)W++;c[15].splice(W,0,q[6]),c[14].splice(W,0,v),c[13]++,j[P][F]=!0;break}if(U&&(g=!0),g&&!U)M=E.length;else if(0===E.length||c[6]<O[6]||c[6]===O[6]&&a.actorIds[c[5]]<y){H=!0,Y(e,t,f,c,a,m,o,k);for(var Z=E.length-1;Z>=0;Z--){for(var X=!0,$=0;$<E[Z][13];$++)j[Z][$]||(X=!1);"del"===p[E[Z][8]]&&X&&(E.splice(Z,1),x.splice(Z,1),j.splice(Z,1))}}else{if(c[6]===O[6]&&a.actorIds[c[5]]===y)throw new RangeError("duplicate operation ID: ".concat(O[6],"@").concat(y));M=1}}else H=!0;if(H){G(n,a.blocks[i].columns,c),D(t,c,a.actorIds,!1),c[7]&&b&&(b=!1,o++),0===c[13]&&(b=!0),t.numOps++;var Q=z(a,i);c=Q.docOp,i=Q.blockIndex,null!==c&&(w++,k=c[13])}if(M>0){for(var ee=0;ee<M;ee++){for(var te=E[ee],ne=0;ne<te[13];ne++)if(!j[ee][ne])throw new RangeError("no matching operation for pred: ".concat(te[15][ne],"@").concat(a.actorIds[te[14][ne]]));G(n,x[ee],te),D(t,te,a.actorIds,!0),Y(e,t,f,te,a,m,o),te[7]?(b=!1,o++):b=!0}M===E.length?(E.length=0,x.length=0,j.length=0):(E.splice(0,M),x.splice(0,M),j.splice(0,M)),t.numOps+=M}}return c&&(G(n,a.blocks[i].columns,c),t.numOps++,D(t,c,a.actorIds,!1)),{docOpsConsumed:w,blockIndex:i}}(e,A,C,t,n,O,w),N=R.blockIndex,S=R.docOpsConsumed,T=n.blocks[N],B=-k-S,_=w;_<=N;_++)B+=n.blocks[_].numOps;q(C,T.columns,B),A.numOps+=B;var U,H=s(T.columns);try{for(H.s();!(U=H.n()).done;){var P=U.value;if(!P.decoder.done)throw new RangeError("excess ops in column ".concat(P.columnId))}}catch(J){H.e(J)}finally{H.f()}if(A.columns=C.map((function(e){var t=I(e.columnId,e.encoder.buffer);return{columnId:e.columnId,decoder:t}})),w===N&&A.numOps<=V)B>0&&void 0!==E.lastVisibleActor&&void 0!==E.lastVisibleCtr&&(A.lastVisibleActor=E.lastVisibleActor,A.lastVisibleCtr=E.lastVisibleCtr),n.blocks[w]=A;else{var F,W=M(A);(F=n.blocks).splice.apply(F,[w,N-w+1].concat(o(W)))}}function Q(e,t){if(t[0].columnId!==g[0].columnId||"objActor"!==g[0].columnName||t[1].columnId!==g[1].columnId||"objCtr"!==g[1].columnName||t[2].columnId!==g[2].columnId||"keyActor"!==g[2].columnName||t[3].columnId!==g[3].columnId||"keyCtr"!==g[3].columnName||t[4].columnId!==g[4].columnId||"keyStr"!==g[4].columnName||t[5].columnId!==g[5].columnId||"idActor"!==g[5].columnName||t[6].columnId!==g[6].columnId||"idCtr"!==g[6].columnName||t[7].columnId!==g[7].columnId||"insert"!==g[7].columnName||t[8].columnId!==g[8].columnId||"action"!==g[8].columnName||t[9].columnId!==g[9].columnId||"valLen"!==g[9].columnName||t[10].columnId!==g[10].columnId||"valRaw"!==g[10].columnName||t[13].columnId!==g[13].columnId||"predNum"!==g[13].columnName||t[14].columnId!==g[14].columnId||"predActor"!==g[14].columnName||t[15].columnId!==g[15].columnId||"predCtr"!==g[15].columnName)throw new RangeError("unexpected columnId");var n=e.blocks[0].columns;if(!t.every((function(e){return N.includes(e.columnId)||n.find((function(t){return t.columnId===e.columnId}))}))){var r,a=n.map((function(e){return{columnId:e.columnId}})),o=s(t);try{var i=function(){var e=r.value.columnId;N.includes(e)||n.find((function(t){return t.columnId===e}))||a.push({columnId:e})};for(o.s();!(r=o.n()).done;)i()}catch(d){o.e(d)}finally{o.f()}a.sort((function(e,t){return e.columnId-t.columnId}));for(var c=0;c<e.blocks.length;c++){var u=l(e.blocks[c]);u.columns=w(u.columns.map((function(e){return{columnId:e.columnId,buffer:e.decoder.buf}})),a),e.blocks[c]=u}}}function ee(e,t){if(e.indexOf(t.actorIds[0])<0){if(1!==t.seq)throw new RangeError("Seq ".concat(t.seq," is the first change for actor ").concat(t.actorIds[0]));e=e.concat([t.actorIds[0]])}var n,r=[],a=s(t.actorIds);try{for(a.s();!(n=a.n()).done;){var o=n.value,i=e.indexOf(o);if(i<0)throw new RangeError("actorId ".concat(o," is not known to document"));r.push(i)}}catch(c){a.e(c)}finally{a.f()}return{actorIds:e,actorTable:r}}function te(e,t,n){var r,a=s(t);try{for(a.s();!(r=a.n()).done;)for(var o=r.value,c=n.objectMeta[o],l=null,d=!1;;){var h=l&&Object.keys(c.children[l.parentKey]).length>0;if(e[o]||(e[o]=W(o,c.type)),l&&h)if("list"===c.type||"text"===c.type){var f,p=s(e[o].edits);try{for(p.s();!(f=p.n()).done;){var v=f.value;v.opId&&c.children[l.parentKey][v.opId]&&(d=!0)}}catch(T){p.e(T)}finally{p.f()}if(!d)for(var y=u(o),g=u(l.parentKey),b={objActor:y.actorId,objCtr:y.counter,keyActor:g.actorId,keyCtr:g.counter,objActorNum:n.actorIds.indexOf(y.actorId),keyActorNum:n.actorIds.indexOf(g.actorId),keyStr:null,insert:!1,objId:o},m=L(n,b).visibleCount,I=0,w=Object.entries(c.children[l.parentKey]);I<w.length;I++){var k=i(w[I],2),O=k[0],E=k[1],x=E;E.objectId&&(e[E.objectId]||(e[E.objectId]=W(E.objectId,E.type)),x=e[E.objectId]);var j={action:"update",index:m,opId:O,value:x};Z(e[o].edits,j)}}else{e[o].props[l.parentKey]||(e[o].props[l.parentKey]={});for(var A=e[o].props[l.parentKey],C=0,V=Object.entries(c.children[l.parentKey]);C<V.length;C++){var R=i(V[C],2),N=R[0],S=R[1];A[N]?d=!0:S.objectId?(e[S.objectId]||(e[S.objectId]=W(S.objectId,S.type)),A[N]=e[S.objectId]):A[N]=S}}if(d||!c.parentObj||l&&!h)break;l=c,o=c.parentObj,c=n.objectMeta[o]}}catch(T){a.e(T)}finally{a.f()}return e}function ne(e,t,n,r,a){var i,c=new Set(n.heads),u=new Set,d=l(n.clock),h=[],f=[],p=s(t);try{for(p.s();!(i=p.n()).done;){var v=i.value;if(void 0===n.changeIndexByHash[v.hash]&&!u.has(v.hash)){var y,g=(d[v.actor]||0)+1,b=!0,m=s(v.deps);try{for(m.s();!(y=m.n()).done;){var I=y.value,w=n.changeIndexByHash[I];void 0!==w&&-1!==w||u.has(I)||(b=!1)}}catch(j){m.e(j)}finally{m.f()}if(b){if(v.seq<g){if(a)throw new RangeError("Reuse of sequence number ".concat(v.seq," for actor ").concat(v.actor));return[[],t]}if(v.seq>g)throw new RangeError("Skipped sequence number ".concat(g," for actor ").concat(v.actor));d[v.actor]=v.seq,u.add(v.hash);var k,O=s(v.deps);try{for(O.s();!(k=O.n()).done;){var E=k.value;c.delete(E)}}catch(j){O.e(j)}finally{O.f()}c.add(v.hash),h.push(v)}else f.push(v)}}}catch(j){p.e(j)}finally{p.f()}if(h.length>0){var x={changes:h,changeIndex:-1,objectIds:r};for(K(n,x);!x.done;)$(e,x,n);n.heads=o(c).sort(),n.clock=d}return[h,f]}function re(e){var t,n=s(e.blocks[0].columns);try{for(n.s();!(t=n.n()).done;){t.value.decoder.reset()}}catch(v){n.e(v)}finally{n.f()}for(var r={},a=null,o=0,i={_root:{objectId:"_root",type:"map",props:{}}},c=null,u=null,l="_root",d=!1,h=0;;){var f=z(e,o);if(a=f.docOp,o=f.blockIndex,null===a)break;a[0]===c&&a[1]===u||(l="".concat(a[1],"@").concat(e.actorIds[a[0]]),c=a[0],u=a[1],r={},h=0,d=!1),a[7]&&d&&(d=!1,h++),0===a[13]&&(d=!0),a[6]>e.maxOp&&(e.maxOp=a[6]);for(var p=0;p<a[13];p++)a[15][p]>e.maxOp&&(e.maxOp=a[15][p]);Y(i,null,l,a,e,r,h,a[13])}return i._root}function ae(e,t,n,r){G(e,b,[n.indexOf(t.actor),t.seq,t.maxOp,t.time,t.message,t.deps.length,t.deps.map((function(e){return r[e]})),t.extraBytes?t.extraBytes.byteLength<<4|f.BYTES:f.BYTES,t.extraBytes])}var oe=function(){"use strict";function e(t){if(r(this,e),this.maxOp=0,this.haveHashGraph=!1,this.changes=[],this.changeIndexByHash={},this.dependenciesByHash={},this.dependentsByHash={},this.hashesByActor={},this.actorIds=[],this.heads=[],this.clock={},this.queue=[],this.objectMeta={_root:{parentObj:null,parentKey:null,opId:null,type:"map",children:{}}},t){var n=A(t),a=function(e){var t=w(e.changesColumns,b),n=t[0].decoder,r=t[1].decoder,a=t[5].decoder,i=t[6].decoder;if(t[0].columnId!==b[0].columnId||"actor"!==b[0].columnName||t[1].columnId!==b[1].columnId||"seq"!==b[1].columnName||t[5].columnId!==b[5].columnId||"depsNum"!==b[5].columnName||t[6].columnId!==b[6].columnId||"depsIndex"!==b[6].columnName)throw new RangeError("unexpected columnId");for(var c=0,u={},l=[],d=new Set;!n.done;){var h=n.readValue(),f=r.readValue(),p=a.readValue(),v=e.actorIds[h];if(1!==f&&f!==u[v]+1)throw new RangeError("Expected seq ".concat(u[v]+1,", got ").concat(f," for actor ").concat(v));l.push(h),u[v]=f,d.add(c);for(var y=0;y<p;y++)d.delete(i.readValue());c++}var g,I=o(d).map((function(t){return e.actorIds[l[t]]})).sort(),k=s(t);try{for(k.s();!(g=k.n()).done;)g.value.decoder.reset()}catch(E){k.e(E)}finally{k.f()}var O=t.map((function(e){return{columnId:e.columnId,encoder:m(e.columnId)}}));return q(O,t,c),{clock:u,headActors:I,encoders:O,numChanges:c}}(n),i=a.clock,c=a.headActors,u=a.encoders,l=a.numChanges;if(this.binaryDoc=t,this.changes=new Array(l),this.actorIds=n.actorIds,this.heads=n.heads,this.clock=i,this.changesEncoders=u,this.extraBytes=n.extraBytes,1===n.heads.length&&1===c.length&&(this.hashesByActor[c[0]]=[],this.hashesByActor[c[0]][i[c[0]]-1]=n.heads[0]),n.heads.length===n.headsIndexes.length)for(var d=0;d<n.heads.length;d++)this.changeIndexByHash[n.heads[d]]=n.headsIndexes[d];else if(1===n.heads.length)this.changeIndexByHash[n.heads[0]]=l-1;else{var h,f=s(n.heads);try{for(f.s();!(h=f.n()).done;){var p=h.value;this.changeIndexByHash[p]=-1}}catch(g){f.e(g)}finally{f.f()}}this.blocks=[{columns:w(n.opsColumns,y)}],H(this.blocks[0]),this.blocks[0].numOps>V&&(this.blocks=M(this.blocks[0]));var v={blocks:this.blocks,actorIds:this.actorIds,objectMeta:this.objectMeta,maxOp:0};this.initPatch=re(v),this.maxOp=v.maxOp}else this.haveHashGraph=!0,this.changesEncoders=b.map((function(e){return{columnId:e.columnId,encoder:m(e.columnId)}})),this.blocks=[{columns:w([],y),bloom:new Uint8Array(R),numOps:0,lastKey:void 0,numVisible:void 0,lastObjectActor:void 0,lastObjectCtr:void 0,firstVisibleActor:void 0,firstVisibleCtr:void 0,lastVisibleActor:void 0,lastVisibleCtr:void 0}]}return a(e,[{key:"clone",value:function(){var t=new e;return t.maxOp=this.maxOp,t.haveHashGraph=this.haveHashGraph,t.changes=this.changes.slice(),t.changeIndexByHash=l(this.changeIndexByHash),t.dependenciesByHash=l(this.dependenciesByHash),t.dependentsByHash=Object.entries(this.dependentsByHash).reduce((function(e,t){var n=i(t,2),r=n[0],a=n[1];return e[r]=a.slice(),e}),{}),t.hashesByActor=Object.entries(this.hashesByActor).reduce((function(e,t){var n=i(t,2),r=n[0],a=n[1];return e[r]=a.slice(),e}),{}),t.actorIds=this.actorIds,t.heads=this.heads,t.clock=this.clock,t.blocks=this.blocks,t.objectMeta=this.objectMeta,t.queue=this.queue,t}},{key:"applyChanges",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.map((function(e){var t=E(e);return t.buffer=e,t})),r={_root:{objectId:"_root",type:"map",props:{}}},a={maxOp:this.maxOp,changeIndexByHash:this.changeIndexByHash,actorIds:this.actorIds,heads:this.heads,clock:this.clock,blocks:this.blocks.slice(),objectMeta:Object.assign({},this.objectMeta)},o=0===this.queue.length?n:n.concat(this.queue),c=[],u=new Set;;){var l=ne(r,o,a,u,this.haveHashGraph),d=i(l,2),h=d[0],f=d[1];o=f;for(var p=0;p<h.length;p++)a.changeIndexByHash[h[p].hash]=this.changes.length+c.length+p;if(h.length>0&&(c=c.concat(h)),0===o.length)break;if(0===h.length){if(this.haveHashGraph)break;this.computeHashGraph(),a.changeIndexByHash=this.changeIndexByHash}}te(r,u,a);var v,y=s(c);try{for(y.s();!(v=y.n()).done;){var g=v.value;this.changes.push(g.buffer),this.hashesByActor[g.actor]||(this.hashesByActor[g.actor]=[]),this.hashesByActor[g.actor][g.seq-1]=g.hash,this.changeIndexByHash[g.hash]=this.changes.length-1,this.dependenciesByHash[g.hash]=g.deps,this.dependentsByHash[g.hash]=[];var b,m=s(g.deps);try{for(m.s();!(b=m.n()).done;){var I=b.value;this.dependentsByHash[I]||(this.dependentsByHash[I]=[]),this.dependentsByHash[I].push(g.hash)}}catch(k){m.e(k)}finally{m.f()}ae(this.changesEncoders,g,a.actorIds,this.changeIndexByHash)}}catch(k){y.e(k)}finally{y.f()}this.maxOp=a.maxOp,this.actorIds=a.actorIds,this.heads=a.heads,this.clock=a.clock,this.blocks=a.blocks,this.objectMeta=a.objectMeta,this.queue=o,this.binaryDoc=null,this.initPatch=null;var w={maxOp:this.maxOp,clock:this.clock,deps:this.heads,pendingChanges:this.queue.length,diffs:r._root};return t&&1===n.length&&(w.actor=n[0].actor,w.seq=n[0].seq),w}},{key:"computeHashGraph",value:function(){var e=this.save();this.haveHashGraph=!0,this.changes=[],this.changeIndexByHash={},this.dependenciesByHash={},this.dependentsByHash={},this.hashesByActor={},this.clock={};var t,n=s(j([e]));try{for(n.s();!(t=n.n()).done;){var r=t.value,a=O(r);this.changes.push(a),this.changeIndexByHash[r.hash]=this.changes.length-1,this.dependenciesByHash[r.hash]=r.deps,this.dependentsByHash[r.hash]=[];var o,i=s(r.deps);try{for(i.s();!(o=i.n()).done;){var c=o.value;this.dependentsByHash[c].push(r.hash)}}catch(l){i.e(l)}finally{i.f()}1===r.seq&&(this.hashesByActor[r.actor]=[]),this.hashesByActor[r.actor].push(r.hash);var u=(this.clock[r.actor]||0)+1;if(r.seq!==u)throw new RangeError("Expected seq ".concat(u,", got seq ").concat(r.seq," from actor ").concat(r.actor));this.clock[r.actor]=r.seq}}catch(l){n.e(l)}finally{n.f()}}},{key:"getChanges",value:function(e){var t=this;if(this.haveHashGraph||this.computeHashGraph(),0===e.length)return this.changes.slice();var n,r=[],a={},i=[],c=s(e);try{for(c.s();!(n=c.n()).done;){var u,l=n.value;a[l]=!0;var d=this.dependentsByHash[l];if(!d)throw new RangeError("hash not found: ".concat(l));(u=r).push.apply(u,o(d))}}catch(g){c.e(g)}finally{c.f()}for(;r.length>0;){var h,f=r.pop();if(a[f]=!0,i.push(f),!this.dependenciesByHash[f].every((function(e){return a[e]})))break;(h=r).push.apply(h,o(this.dependentsByHash[f]))}if(0===r.length&&this.heads.every((function(e){return a[e]})))return i.map((function(e){return t.changes[t.changeIndexByHash[e]]}));for(r=e.slice(),a={};r.length>0;){var p=r.pop();if(!a[p]){var v,y=this.dependenciesByHash[p];if(!y)throw new RangeError("hash not found: ".concat(p));(v=r).push.apply(v,o(y)),a[p]=!0}}return this.changes.filter((function(e){return!a[x(e,!0).hash]}))}},{key:"getChangesAdded",value:function(e){var t=this;this.haveHashGraph||this.computeHashGraph();for(var n=this.heads.slice(),r={},a=[];n.length>0;){var i=n.pop();r[i]||void 0!==e.changeIndexByHash[i]||(r[i]=!0,a.push(i),n.push.apply(n,o(this.dependenciesByHash[i])))}return a.reverse().map((function(e){return t.changes[t.changeIndexByHash[e]]}))}},{key:"getChangeByHash",value:function(e){return this.haveHashGraph||this.computeHashGraph(),this.changes[this.changeIndexByHash[e]]}},{key:"getMissingDeps",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.haveHashGraph||this.computeHashGraph();var t,n=new Set(e),r=new Set,a=s(this.queue);try{for(a.s();!(t=a.n()).done;){var o=t.value;r.add(o.hash);var i,c=s(o.deps);try{for(c.s();!(i=c.n()).done;){var u=i.value;n.add(u)}}catch(p){c.e(p)}finally{c.f()}}}catch(p){a.e(p)}finally{a.f()}var l,d=[],h=s(n);try{for(h.s();!(l=h.n()).done;){var f=l.value;void 0!==this.changeIndexByHash[f]||r.has(f)||d.push(f)}}catch(p){h.e(p)}finally{h.f()}return d.sort()}},{key:"save",value:function(){var e=this;if(this.binaryDoc)return this.binaryDoc;var t=this.changesEncoders.map((function(e){return{columnId:e.columnId,encoder:m(e.columnId)}}));return q(t,this.changesEncoders.map((function(e){var t=I(e.columnId,e.encoder.buffer);return{columnId:e.columnId,decoder:t}})),this.changes.length),this.binaryDoc=C({changesColumns:this.changesEncoders,opsColumns:P(this.blocks),actorIds:this.actorIds,heads:this.heads,headsIndexes:this.heads.map((function(t){return e.changeIndexByHash[t]})),extraBytes:this.extraBytes}),this.changesEncoders=t,this.binaryDoc}},{key:"getPatch",value:function(){var e={blocks:this.blocks,actorIds:this.actorIds,objectMeta:{_root:{parentObj:null,parentKey:null,opId:null,type:"map",children:{}}},maxOp:0},t=this.initPatch?this.initPatch:re(e);return{maxOp:this.maxOp,clock:this.clock,deps:this.heads,pendingChanges:this.queue.length,diffs:t}}}]),e}();e.exports={MAX_BLOCK_SIZE:V,BackendDoc:oe,bloomFilterContains:U}},7855:function(e,t,n){var r=n(3038).default,a=n(319).default,o=n(3269).default,i=n(4575).default,s=n(3913).default,c=n(3014),u=n(656),l=u.hexStringToBytes,d=u.bytesToHexString,h=u.Encoder,f=u.Decoder,p=n(8504).decodeChangeMeta,v=n(4443).copyObject,y=function(){"use strict";function e(t){if(i(this,e),Array.isArray(t)){this.numEntries=t.length,this.numBitsPerEntry=10,this.numProbes=7,this.bits=new Uint8Array(Math.ceil(this.numEntries*this.numBitsPerEntry/8));var n,r=o(t);try{for(r.s();!(n=r.n()).done;){var a=n.value;this.addHash(a)}}catch(c){r.e(c)}finally{r.f()}}else{if(!(t instanceof Uint8Array))throw new TypeError("invalid argument");if(0===t.byteLength)this.numEntries=0,this.numBitsPerEntry=0,this.numProbes=0,this.bits=t;else{var s=new f(t);this.numEntries=s.readUint32(),this.numBitsPerEntry=s.readUint32(),this.numProbes=s.readUint32(),this.bits=s.readRawBytes(Math.ceil(this.numEntries*this.numBitsPerEntry/8))}}}return s(e,[{key:"bytes",get:function(){if(0===this.numEntries)return new Uint8Array(0);var e=new h;return e.appendUint32(this.numEntries),e.appendUint32(this.numBitsPerEntry),e.appendUint32(this.numProbes),e.appendRawBytes(this.bits),e.buffer}},{key:"getProbes",value:function(e){var t=l(e),n=8*this.bits.byteLength;if(32!==t.byteLength)throw new RangeError("Not a 256-bit hash: ".concat(e));for(var r=((t[0]|t[1]<<8|t[2]<<16|t[3]<<24)>>>0)%n,a=((t[4]|t[5]<<8|t[6]<<16|t[7]<<24)>>>0)%n,o=((t[8]|t[9]<<8|t[10]<<16|t[11]<<24)>>>0)%n,i=[r],s=1;s<this.numProbes;s++)r=(r+a)%n,a=(a+o)%n,i.push(r);return i}},{key:"addHash",value:function(e){var t,n=o(this.getProbes(e));try{for(n.s();!(t=n.n()).done;){var r=t.value;this.bits[r>>>3]|=1<<(7&r)}}catch(a){n.e(a)}finally{n.f()}}},{key:"containsHash",value:function(e){if(0===this.numEntries)return!1;var t,n=o(this.getProbes(e));try{for(n.s();!(t=n.n()).done;){var r=t.value;if(0===(this.bits[r>>>3]&1<<(7&r)))return!1}}catch(a){n.e(a)}finally{n.f()}return!0}}]),e}();function g(e,t){if(!Array.isArray(t))throw new TypeError("hashes must be an array");e.appendUint32(t.length);for(var n=0;n<t.length;n++){if(n>0&&t[n-1]>=t[n])throw new RangeError("hashes must be sorted");var r=l(t[n]);if(32!==r.byteLength)throw new TypeError("heads hashes must be 256 bits");e.appendRawBytes(r)}}function b(e){for(var t=e.readUint32(),n=[],r=0;r<t;r++)n.push(d(e.readRawBytes(32)));return n}function m(e){var t=new h;t.appendByte(66),g(t,e.heads),g(t,e.need),t.appendUint32(e.have.length);var n,r=o(e.have);try{for(r.s();!(n=r.n()).done;){var a=n.value;g(t,a.lastSync),t.appendPrefixedBytes(a.bloom)}}catch(u){r.e(u)}finally{r.f()}t.appendUint32(e.changes.length);var i,s=o(e.changes);try{for(s.s();!(i=s.n()).done;){var c=i.value;t.appendPrefixedBytes(c)}}catch(u){s.e(u)}finally{s.f()}return t.buffer}function I(e){var t=new f(e),n=t.readByte();if(66!==n)throw new RangeError("Unexpected message type: ".concat(n));for(var r=b(t),a=b(t),o=t.readUint32(),i={heads:r,need:a,have:[],changes:[]},s=0;s<o;s++){var c=b(t),u=t.readPrefixedBytes(t);i.have.push({lastSync:c,bloom:u})}for(var l=t.readUint32(),d=0;d<l;d++){var h=t.readPrefixedBytes();i.changes.push(h)}return i}function w(e,t){var n=c.getChanges(e,t).map((function(e){return p(e,!0).hash}));return{lastSync:t,bloom:new y(n).bytes}}function k(){return{sharedHeads:[],lastSentHeads:[],theirHeads:null,theirNeed:null,theirHave:null,sentHashes:{}}}function O(e,t){return e.length===t.length&&e.every((function(e,n){return e===t[n]}))}e.exports={receiveSyncMessage:function(e,t,n){if(!e)throw new Error("generateSyncMessage called with no Automerge document");if(!t)throw new Error("generateSyncMessage requires a syncState, which can be created with initSyncState()");var o=t.sharedHeads,i=t.lastSentHeads,s=t.sentHashes,u=null,l=I(n),d=c.getHeads(e);if(l.changes.length>0){var h=c.applyChanges(e,l.changes),f=r(h,2);e=f[0],u=f[1],o=function(e,t,n){var r=t.filter((function(t){return!e.includes(t)})),o=n.filter((function(e){return t.includes(e)}));return a(new Set([].concat(a(r),a(o)))).sort()}(d,c.getHeads(e),o)}0===l.changes.length&&O(l.heads,d)&&(i=l.heads);var p=l.heads.filter((function(t){return c.getChangeByHash(e,t)}));p.length===l.heads.length?(o=l.heads,0===l.heads.length&&(i=[],s=[])):o=a(new Set(p.concat(o))).sort();var v={sharedHeads:o,lastSentHeads:i,theirHave:l.have,theirHeads:l.heads,theirNeed:l.need,sentHashes:s};return[e,v,u]},generateSyncMessage:function(e,t){if(!e)throw new Error("generateSyncMessage called with no Automerge document");if(!t)throw new Error("generateSyncMessage requires a syncState, which can be created with initSyncState()");var n=t,r=n.sharedHeads,a=n.lastSentHeads,i=n.theirHeads,s=n.theirNeed,u=n.theirHave,l=n.sentHashes,d=c.getHeads(e),h=c.getMissingDeps(e,i||[]),f=[];if(i&&!h.every((function(e){return i.includes(e)}))||(f=[w(e,r)]),u&&u.length>0&&!u[0].lastSync.every((function(t){return c.getChangeByHash(e,t)})))return[t,m({heads:d,need:[],have:[{lastSync:[],bloom:new Uint8Array(0)}],changes:[]})];var g=Array.isArray(u)&&Array.isArray(s)?function(e,t,n){if(0===t.length)return n.map((function(t){return c.getChangeByHash(e,t)})).filter((function(e){return void 0!==e}));var r,a={},i=[],s=o(t);try{for(s.s();!(r=s.n()).done;){var u,l=r.value,d=o(l.lastSync);try{for(d.s();!(u=d.n()).done;)a[u.value]=!0}catch(B){d.e(B)}finally{d.f()}i.push(new y(l.bloom))}}catch(B){s.e(B)}finally{s.f()}var h,f=c.getChanges(e,Object.keys(a)).map((function(e){return p(e,!0)})),v={},g={},b={},m=o(f);try{var I=function(){var e=h.value;v[e.hash]=!0;var t,n=o(e.deps);try{for(n.s();!(t=n.n()).done;){var r=t.value;g[r]||(g[r]=[]),g[r].push(e.hash)}}catch(B){n.e(B)}finally{n.f()}i.every((function(t){return!t.containsHash(e.hash)}))&&(b[e.hash]=!0)};for(m.s();!(h=m.n()).done;)I()}catch(B){m.e(B)}finally{m.f()}for(var w=Object.keys(b);w.length>0;){var k=w.pop();if(g[k]){var O,E=o(g[k]);try{for(E.s();!(O=E.n()).done;){var x=O.value;b[x]||(b[x]=!0,w.push(x))}}catch(B){E.e(B)}finally{E.f()}}}var j,A=[],C=o(n);try{for(C.s();!(j=C.n()).done;){var V=j.value;if(b[V]=!0,!v[V]){var R=c.getChangeByHash(e,V);R&&A.push(R)}}}catch(B){C.e(B)}finally{C.f()}var N,S=o(f);try{for(S.s();!(N=S.n()).done;){var T=N.value;b[T.hash]&&A.push(T.change)}}catch(B){S.e(B)}finally{S.f()}return A}(e,u,s):[],b=Array.isArray(a)&&O(d,a),I=Array.isArray(i)&&O(d,i);if(b&&I&&0===g.length)return[t,null];g=g.filter((function(e){return!l[p(e,!0).hash]}));var k={heads:d,have:f,need:h,changes:g};if(g.length>0){l=v(l);var E,x=o(g);try{for(x.s();!(E=x.n()).done;){var j=E.value;l[p(j,!0).hash]=!0}}catch(A){x.e(A)}finally{x.f()}}return[t=Object.assign({},t,{lastSentHeads:d,sentHashes:l}),m(k)]},encodeSyncMessage:m,decodeSyncMessage:I,initSyncState:k,encodeSyncState:function(e){var t=new h;return t.appendByte(67),g(t,e.sharedHeads),t.buffer},decodeSyncState:function(e){var t=new f(e),n=t.readByte();if(67!==n)throw new RangeError("Unexpected record type: ".concat(n));var r=b(t);return Object.assign({sharedHeads:[],lastSentHeads:[],theirHeads:null,theirNeed:null,theirHave:null,sentHashes:{}},{sharedHeads:r})},BloomFilter:y}},8577:function(e){e.exports={backendState:function(e){if(e.frozen)throw new Error("Attempting to use an outdated Automerge document that has already been updated. Please use the latest document state, or call Automerge.clone() if you really need to use this old document state.");return e.state}}},4865:function(e,t,n){var r=n(319).default,a=n(9713).default,o=n(3269).default,i=n(4443),s=i.isObject,c=i.copyObject,u=i.parseOpId,l=n(5094),d=l.OBJECT_ID,h=l.CONFLICTS,f=l.ELEM_IDS,p=n(4350).instantiateText,v=n(6939).instantiateTable,y=n(2886).Counter;function g(e,t,n){return e.objectId?(t&&t[d]!==e.objectId&&(t=void 0),k(e,t,n)):"timestamp"===e.datatype?new Date(e.value):"counter"===e.datatype?new y(e.value):e.value}function b(e,t){var n=/^(\d+)@(.*)$/,r=n.test(e)?u(e):{counter:0,actorId:e},a=n.test(t)?u(t):{counter:0,actorId:t};return r.counter<a.counter?-1:r.counter>a.counter?1:r.actorId<a.actorId?-1:r.actorId>a.actorId?1:0}function m(e,t){var n=c(e),r=c(e?e[h]:void 0);return Object.defineProperty(n,d,{value:t}),Object.defineProperty(n,h,{value:r}),n}function I(e,t,n){var r=e.objectId;n[r]||(n[r]=m(t,r));var a=n[r];return function(e,t,n,r){if(e)for(var a=0,i=Object.keys(e);a<i.length;a++){var s,c=i[a],u={},l=Object.keys(e[c]).sort(b).reverse(),d=o(l);try{for(d.s();!(s=d.n()).done;){var h=s.value,f=e[c][h];n[c]&&n[c][h]?u[h]=g(f,n[c][h],r):u[h]=g(f,void 0,r)}}catch(p){d.e(p)}finally{d.f()}0===l.length?(delete t[c],delete n[c]):(t[c]=u[l[0]],n[c]=u)}}(e.props,a,a[h],n),a}function w(e,t,n){var r=e.objectId;n[r]||(n[r]=function(e,t){var n=e?e.slice():[],r=e&&e[h]?e[h].slice():[],a=e&&e[f]?e[f].slice():[];return Object.defineProperty(n,d,{value:t}),Object.defineProperty(n,h,{value:r}),Object.defineProperty(n,f,{value:a}),n}(t,r));for(var o=n[r],i=o[h],s=o[f],c=0;c<e.edits.length;c++){var l=e.edits[c];if("insert"===l.action||"update"===l.action){for(var p=i[l.index]&&i[l.index][l.opId],v=g(l.value,p,n),y=a({},l.opId,v);c<e.edits.length-1&&e.edits[c+1].index===l.index&&"update"===e.edits[c+1].action;){c++;var b=e.edits[c],m=i[b.index]&&i[b.index][b.opId];v=g(b.value,m,n),y[b.opId]=v}"insert"===l.action?(o.splice(l.index,0,v),i.splice(l.index,0,y),s.splice(l.index,0,l.elemId)):(o[l.index]=v,i[l.index]=y)}else"multi-insert"===l.action?function(){var e=u(l.elemId),t=[],r=[],c=[],d=l.datatype;l.values.forEach((function(o,i){var s="".concat(e.counter+i,"@").concat(e.actorId);o=g({value:o,datatype:d},void 0,n),r.push(o),c.push(a({},s,{value:o,datatype:d,type:"value"})),t.push(s)})),o.splice.apply(o,[l.index,0].concat(r)),i.splice.apply(i,[l.index,0].concat(c)),s.splice.apply(s,[l.index,0].concat(t))}():"remove"===l.action&&(o.splice(l.index,l.count),i.splice(l.index,l.count),s.splice(l.index,l.count))}return o}function k(e,t,n){if(s(t)&&(!e.props||0===Object.keys(e.props).length)&&(!e.edits||0===e.edits.length)&&!n[e.objectId])return t;if("map"===e.type)return I(e,t,n);if("table"===e.type)return function(e,t,n){var r=e.objectId;n[r]||(n[r]=t?t._clone():v(r));for(var a=n[r],o=0,i=Object.keys(e.props||{});o<i.length;o++){var s=i[o],c=Object.keys(e.props[s]);if(0===c.length)a.remove(s);else{if(1!==c.length)throw new RangeError("Conflicts are not supported on properties of a table");var u=e.props[s][c[0]];a._set(s,g(u,a.byId(s),n),c[0])}}return a}(e,t,n);if("list"===e.type)return w(e,t,n);if("text"===e.type)return function(e,t,n){var a,i=e.objectId;a=n[i]?n[i].elems:t?t.elems.slice():[];var s,c=o(e.edits);try{for(c.s();!(s=c.n()).done;){var l=s.value;if("insert"===l.action){var d=g(l.value,void 0,n),h={elemId:l.elemId,pred:[l.opId],value:d};a.splice(l.index,0,h)}else if("multi-insert"===l.action)!function(){var e,t=u(l.elemId),o=l.datatype,i=l.values.map((function(e,r){e=g({datatype:o,value:e},void 0,n);var a="".concat(t.counter+r,"@").concat(t.actorId);return{elemId:a,pred:[a],value:e}}));(e=a).splice.apply(e,[l.index,0].concat(r(i)))}();else if("update"===l.action){var f=a[l.index].elemId,v=g(l.value,a[l.index].value,n);a[l.index]={elemId:f,pred:[l.opId],value:v}}else"remove"===l.action&&a.splice(l.index,l.count)}}catch(y){c.e(y)}finally{c.f()}return n[i]=p(i,a),n[i]}(e,t,n);throw new TypeError("Unknown object type: ".concat(e.type))}e.exports={interpretPatch:k,cloneRootObject:function(e){if("_root"!==e[d])throw new RangeError("Not the root object: ".concat(e[d]));return m(e,"_root")}}},5094:function(e){var t=Symbol("_options"),n=Symbol("_cache"),r=Symbol("_state"),a=Symbol("_objectId"),o=Symbol("_conflicts"),i=Symbol("_change"),s=Symbol("_elemIds");e.exports={OPTIONS:t,CACHE:n,STATE:r,OBJECT_ID:a,CONFLICTS:o,CHANGE:i,ELEM_IDS:s}},5295:function(e,t,n){var r=n(319).default,a=n(3269).default,o=n(9713).default,i=n(4575).default,s=n(3913).default,c=n(5094),u=c.CACHE,l=c.OBJECT_ID,d=c.CONFLICTS,h=c.ELEM_IDS,f=c.STATE,p=n(4865).interpretPatch,v=n(4350).Text,y=n(6939).Table,g=n(2886),b=g.Counter,m=g.getWriteableCounter,I=n(776),w=I.Int,k=I.Uint,O=I.Float64,E=n(4443),x=E.isObject,j=E.parseOpId,A=E.createArrayOfNulls,C=n(9860),V=function(){"use strict";function e(t,n,r){i(this,e),this.actorId=n,this.nextOpNum=t[f].maxOp+1,this.cache=t[u],this.updated={},this.ops=[],this.applyPatch=r||p}return s(e,[{key:"addOp",value:function(e){this.ops.push(e),"set"===e.action&&e.values?this.nextOpNum+=e.values.length:"del"===e.action&&e.multiOp?this.nextOpNum+=e.multiOp:this.nextOpNum+=1}},{key:"nextOpId",value:function(){return"".concat(this.nextOpNum,"@").concat(this.actorId)}},{key:"getValueDescription",value:function(e){if(!["object","boolean","number","string"].includes(typeof e))throw new TypeError("Unsupported type of value: ".concat(typeof e));if(x(e)){if(e instanceof Date)return{type:"value",value:e.getTime(),datatype:"timestamp"};if(e instanceof w)return{type:"value",value:e.value,datatype:"int"};if(e instanceof k)return{type:"value",value:e.value,datatype:"uint"};if(e instanceof O)return{type:"value",value:e.value,datatype:"float64"};if(e instanceof b)return{type:"value",value:e.value,datatype:"counter"};var t=e[l],n=this.getObjectType(t);if(!t)throw new RangeError("Object ".concat(JSON.stringify(e)," has no objectId"));return"list"===n||"text"===n?{objectId:t,type:n,edits:[]}:{objectId:t,type:n,props:{}}}return"number"===typeof e?Number.isInteger(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER?{type:"value",value:e,datatype:"int"}:{type:"value",value:e,datatype:"float64"}:{type:"value",value:e}}},{key:"getValuesDescriptions",value:function(e,t,n){if(t instanceof y){var r=t.byId(n),a=t.opIds[n];return r?o({},a,this.getValueDescription(r)):{}}if(t instanceof v){var i=t.get(n),s=t.getElemId(n);return i?o({},s,this.getValueDescription(i)):{}}var c=t[d][n],u={};if(!c)throw new RangeError("No children at key ".concat(n," of path ").concat(JSON.stringify(e)));for(var l=0,h=Object.keys(c);l<h.length;l++){var f=h[l];u[f]=this.getValueDescription(c[f])}return u}},{key:"getPropertyValue",value:function(e,t,n){return e instanceof y?e.byId(t):e instanceof v?e.get(t):e[d][t][n]}},{key:"getSubpatch",value:function(e,t){if(0==t.length)return e;var n,r=e,o=this.getObject("_root"),i=a(t);try{for(i.s();!(n=i.n()).done;){var s=n.value,c=this.getValuesDescriptions(t,o,s.key);if(r.props)r.props[s.key]||(r.props[s.key]=c);else if(r.edits)for(var u=0,l=Object.keys(c);u<l.length;u++){var d=l[u];r.edits.push({action:"update",index:s.key,opId:d,value:c[d]})}for(var h=null,f=0,p=Object.keys(c);f<p.length;f++){var v=p[f];c[v].objectId===s.objectId&&(h=v)}if(!h)throw new RangeError("Cannot find path object with objectId ".concat(s.objectId));r=c[h],o=this.getPropertyValue(o,s.key,h)}}catch(y){i.e(y)}finally{i.f()}return r}},{key:"getObject",value:function(e){var t=this.updated[e]||this.cache[e];if(!t)throw new RangeError("Target object does not exist: ".concat(e));return t}},{key:"getObjectType",value:function(e){if("_root"===e)return"map";var t=this.getObject(e);return t instanceof v?"text":t instanceof y?"table":Array.isArray(t)?"list":"map"}},{key:"getObjectField",value:function(e,t,n){if(["string","number"].includes(typeof n)){var r=this.getObject(t);if(r[n]instanceof b)return m(r[n].value,this,e,t,n);if(x(r[n])){var a=r[n][l],o=e.concat([{key:n,objectId:a}]);return this.instantiateObject(o,a)}return r[n]}}},{key:"createNestedObjects",value:function(e,t,n,i,s,c){if(n[l])throw new RangeError("Cannot create a reference to an existing document object");var u=this.nextOpId();if(n instanceof v){this.addOp(c?{action:"makeText",obj:e,elemId:c,insert:i,pred:s}:{action:"makeText",obj:e,key:t,insert:i,pred:s});var d={objectId:u,type:"text",edits:[]};return this.insertListItems(d,0,r(n),!0),d}if(n instanceof y){if(n.count>0)throw new RangeError("Assigning a non-empty Table object is not supported");return this.addOp(c?{action:"makeTable",obj:e,elemId:c,insert:i,pred:s}:{action:"makeTable",obj:e,key:t,insert:i,pred:s}),{objectId:u,type:"table",props:{}}}if(Array.isArray(n)){this.addOp(c?{action:"makeList",obj:e,elemId:c,insert:i,pred:s}:{action:"makeList",obj:e,key:t,insert:i,pred:s});var h={objectId:u,type:"list",edits:[]};return this.insertListItems(h,0,n,!0),h}this.addOp(c?{action:"makeMap",obj:e,elemId:c,insert:i,pred:s}:{action:"makeMap",obj:e,key:t,insert:i,pred:s});var f,p={},g=a(Object.keys(n).sort());try{for(g.s();!(f=g.n()).done;){var b=f.value,m=this.nextOpId(),I=this.setValue(u,b,n[b],!1,[]);p[b]=o({},m,I)}}catch(w){g.e(w)}finally{g.f()}return{objectId:u,type:"map",props:p}}},{key:"setValue",value:function(e,t,n,r,a,o){if(!e)throw new RangeError("setValue needs an objectId");if(""===t)throw new RangeError("The key of a map entry must not be an empty string");if(!x(n)||n instanceof Date||n instanceof b||n instanceof w||n instanceof k||n instanceof O){var i=this.getValueDescription(n),s={action:"set",obj:e,insert:r,value:i.value,pred:a};return o?s.elemId=o:s.key=t,i.datatype&&(s.datatype=i.datatype),this.addOp(s),i}return this.createNestedObjects(e,t,n,r,a,o)}},{key:"applyAtPath",value:function(e,t){var n={objectId:"_root",type:"map",props:{}};t(this.getSubpatch(n,e)),this.applyPatch(n,this.cache._root,this.updated)}},{key:"setMapKey",value:function(e,t,n){var r=this;if("string"!==typeof t)throw new RangeError("The key of a map entry must be a string, not ".concat(typeof t));var a=0===e.length?"_root":e[e.length-1].objectId,i=this.getObject(a);if(i[t]instanceof b)throw new RangeError("Cannot overwrite a Counter object; use .increment() or .decrement() to change its value.");(i[t]!==n||Object.keys(i[d][t]||{}).length>1||void 0===n)&&this.applyAtPath(e,(function(e){var s=R(i,t),c=r.nextOpId(),u=r.setValue(a,t,n,!1,s);e.props[t]=o({},c,u)}))}},{key:"deleteMapKey",value:function(e,t){var n=0===e.length?"_root":e[e.length-1].objectId,r=this.getObject(n);if(void 0!==r[t]){var a=R(r,t);this.addOp({action:"del",obj:n,key:t,insert:!1,pred:a}),this.applyAtPath(e,(function(e){e.props[t]={}}))}}},{key:"insertListItems",value:function(e,t,n,r){var a=this,o=r?[]:this.getObject(e.objectId);if(t<0||t>o.length)throw new RangeError("List index ".concat(t," is out of bounds for list of length ").concat(o.length));if(0!==n.length){var i=N(o,t,!0),s=n.every((function(e){return"string"===typeof e||"number"===typeof e||"boolean"===typeof e||null===e||x(e)&&(e instanceof Date||e instanceof b||e instanceof w||e instanceof k||e instanceof O)})),c=s?n.map((function(e){return a.getValueDescription(e)})):[],u=c.every((function(e){return e.datatype===c[0].datatype}));if(s&&u&&n.length>1){var l=this.nextOpId(),d=c[0].datatype,h=c.map((function(e){return e.value})),f={action:"set",obj:e.objectId,elemId:i,insert:!0,values:h,pred:[]},p={action:"multi-insert",elemId:l,index:t,values:h};d&&(f.datatype=d,p.datatype=d),this.addOp(f),e.edits.push(p)}else for(var v=0;v<n.length;v++){var y=this.nextOpId(),g=this.setValue(e.objectId,t+v,n[v],!0,[],i);i=y,e.edits.push({action:"insert",index:t+v,elemId:i,opId:i,value:g})}}}},{key:"setListIndex",value:function(e,t,n){var r=this,a=0===e.length?"_root":e[e.length-1].objectId,o=this.getObject(a);if(t>=o.length){var i=A(t-o.length);return i.push(n),this.splice(e,o.length,0,i)}if(o[t]instanceof b)throw new RangeError("Cannot overwrite a Counter object; use .increment() or .decrement() to change its value.");(o[t]!==n||Object.keys(o[d][t]||{}).length>1||void 0===n)&&this.applyAtPath(e,(function(e){var i=R(o,t),s=r.nextOpId(),c=r.setValue(a,t,n,!1,i,N(o,t));e.edits.push({action:"update",index:t,opId:s,value:c})}))}},{key:"splice",value:function(e,t,n,r){var a=0===e.length?"_root":e[e.length-1].objectId,o=this.getObject(a);if(t<0||n<0||t>o.length-n)throw new RangeError("".concat(n," deletions starting at index ").concat(t," are out of bounds for list of length ").concat(o.length));if(0!==n||0!==r.length){var i={objectId:"_root",type:"map",props:{}},s=this.getSubpatch(i,e);if(n>0){for(var c,u,l,d=0;d<n;d++){if(this.getObjectField(e,a,t+d)instanceof b)throw new TypeError("Unsupported operation: deleting a counter from a list");var h=N(o,t+d),f=j(h),p=R(o,t+d),v=1===p.length?j(p[0]):void 0;c&&u&&l&&v&&u.actorId===f.actorId&&u.counter+1===f.counter&&l.actorId===v.actorId&&l.counter+1===v.counter?c.multiOp=(c.multiOp||1)+1:(c&&this.addOp(c),c={action:"del",obj:a,elemId:h,insert:!1,pred:p}),u=f,l=v}this.addOp(c),s.edits.push({action:"remove",index:t,count:n})}r.length>0&&this.insertListItems(s,t,r,!1),this.applyPatch(i,this.cache._root,this.updated)}}},{key:"addTableRow",value:function(e,t){if(!x(t)||Array.isArray(t))throw new TypeError("A table row must be an object");if(t[l])throw new TypeError("Cannot reuse an existing object as table row");if(t.id)throw new TypeError('A table row must not have an "id" property; it is generated automatically');var n=C(),r=this.setValue(e[e.length-1].objectId,n,t,!1,[]);return this.applyAtPath(e,(function(e){e.props[n]=o({},r.objectId,r)})),n}},{key:"deleteTableRow",value:function(e,t,n){var r=e[e.length-1].objectId;this.getObject(r).byId(t)&&(this.addOp({action:"del",obj:r,key:t,insert:!1,pred:[n]}),this.applyAtPath(e,(function(e){e.props[t]={}})))}},{key:"increment",value:function(e,t,n){var r=0===e.length?"_root":e[e.length-1].objectId,a=this.getObject(r);if(!(a[t]instanceof b))throw new TypeError("Only counter values can be incremented");var i=this.getObjectType(r),s=a[t].value+n,c=this.nextOpId(),u=R(a,t);if("list"===i||"text"===i){var l=N(a,t,!1);this.addOp({action:"inc",obj:r,elemId:l,value:n,insert:!1,pred:u})}else this.addOp({action:"inc",obj:r,key:t,value:n,insert:!1,pred:u});this.applyAtPath(e,(function(e){"list"===i||"text"===i?e.edits.push({action:"update",index:t,opId:c,value:{value:s,datatype:"counter"}}):e.props[t]=o({},c,{value:s,datatype:"counter"})}))}}]),e}();function R(e,t){return e instanceof y?[e.opIds[t]]:e instanceof v?e.elems[t].pred:e[d]&&e[d][t]?Object.keys(e[d][t]):[]}function N(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(n){if(0===t)return"_head";t-=1}if(e[h])return e[h][t];if(e.getElemId)return e.getElemId(t);throw new RangeError("Cannot find elemId at list index ".concat(t))}e.exports={Context:V}},2886:function(e,t,n){var r=n(2205).default,a=n(9842).default,o=n(4575).default,i=n(3913).default,s=function(){"use strict";function e(t){o(this,e),this.value=t||0,Object.freeze(this)}return i(e,[{key:"valueOf",value:function(){return this.value}},{key:"toString",value:function(){return this.valueOf().toString()}},{key:"toJSON",value:function(){return this.value}}]),e}(),c=function(e){"use strict";r(n,e);var t=a(n);function n(){return o(this,n),t.apply(this,arguments)}return i(n,[{key:"increment",value:function(e){return e="number"===typeof e?e:1,this.context.increment(this.path,this.key,e),this.value+=e,this.value}},{key:"decrement",value:function(e){return this.increment("number"===typeof e?-e:-1)}}]),n}(s);e.exports={Counter:s,getWriteableCounter:function(e,t,n,r,a){var o=Object.create(c.prototype);return o.value=e,o.context=t,o.path=n,o.objectId=r,o.key=a,o}}},2125:function(e,t,n){var r=n(3269).default,a=n(3038).default,o=n(5094),i=o.OPTIONS,s=o.CACHE,c=o.STATE,u=o.OBJECT_ID,l=o.CONFLICTS,d=o.CHANGE,h=o.ELEM_IDS,f=n(4443),p=f.isObject,v=f.copyObject,y=n(9860),g=n(4865),b=g.interpretPatch,m=g.cloneRootObject,I=n(7968).rootObjectProxy,w=n(5295).Context,k=n(4350).Text,O=n(6939).Table,E=n(2886).Counter,x=n(776),j=x.Float64,A=x.Int,C=x.Uint,V=n(2647).Observable;function R(e){if("string"!==typeof e)throw new TypeError("Unsupported type of actorId: ".concat(typeof e));if(!/^[0-9a-f]+$/.test(e))throw new RangeError("actorId must consist only of lowercase hex digits");if(e.length%2!==0)throw new RangeError("actorId must consist of an even number of digits")}function N(e,t,n){var r=t._root;if(r||(r=m(e[s]._root),t._root=r),Object.defineProperty(r,i,{value:e[i]}),Object.defineProperty(r,s,{value:t}),Object.defineProperty(r,c,{value:n}),e[i].freeze)for(var a=0,o=Object.keys(t);a<o.length;a++){var u=o[a];t[u]instanceof O?t[u]._freeze():t[u]instanceof k?(Object.freeze(t[u].elems),Object.freeze(t[u])):(Object.freeze(t[u]),Object.freeze(t[u][l]))}for(var d=0,h=Object.keys(e[s]);d<h.length;d++){var f=h[d];t[f]||(t[f]=e[s][f])}return e[i].freeze&&Object.freeze(t),r}function S(e,t,n){var o=_(e);if(!o)throw new Error("Actor ID must be initialized with setActorId() before making a change");var s=v(e[c]);s.seq+=1;var u={actor:o,seq:s.seq,startOp:s.maxOp+1,deps:s.deps,time:n&&"number"===typeof n.time?n.time:Math.round((new Date).getTime()/1e3),message:n&&"string"===typeof n.message?n.message:"",ops:t.ops};if(e[i].backend){var l=e[i].backend.applyLocalChange(s.backendState,u),d=a(l,3),h=d[0],f=d[1],p=d[2];s.backendState=h,s.lastLocalChange=p;var y=T(e,f,s,!0),g=n&&n.patchCallback||e[i].patchCallback;return g&&g(f,e,y,!0,[p]),[y,u]}var b={actor:o,seq:u.seq,before:e};return s.requests=s.requests.concat([b]),s.maxOp=s.maxOp+function(e){var t,n=0,a=r(e);try{for(a.s();!(t=a.n()).done;){var o=t.value;"set"===o.action&&o.values?n+=o.values.length:n+=1}}catch(i){a.e(i)}finally{a.f()}return n}(u.ops),s.deps=[],[N(e,t?t.updated:{},s),u]}function T(e,t,n,r){var a=_(e),o={};if(b(t.diffs,e,o),r){if(!t.clock)throw new RangeError("patch is missing clock field");t.clock[a]&&t.clock[a]>n.seq&&(n.seq=t.clock[a]),n.clock=t.clock,n.deps=t.deps,n.maxOp=Math.max(n.maxOp,t.maxOp)}return N(e,o,n)}function B(e){if("string"===typeof e)e={actorId:e};else if("undefined"===typeof e)e={};else if(!p(e))throw new TypeError("Unsupported value for init() options: ".concat(e));if(e.deferActorId||(void 0===e.actorId&&(e.actorId=y()),R(e.actorId)),e.observable){var t=e.patchCallback,n=e.observable;e.patchCallback=function(e,r,a,o,i){t&&t(e,r,a,o,i),n.patchCallback(e,r,a,o,i)}}var r={},a={_root:r},o={seq:0,maxOp:0,requests:[],clock:{},deps:[]};return e.backend&&(o.backendState=e.backend.init(),o.lastLocalChange=null),Object.defineProperty(r,u,{value:"_root"}),Object.defineProperty(r,i,{value:Object.freeze(e)}),Object.defineProperty(r,l,{value:Object.freeze({})}),Object.defineProperty(r,s,{value:Object.freeze(a)}),Object.defineProperty(r,c,{value:Object.freeze(o)}),Object.freeze(r)}function L(e,t,n){if("_root"!==e[u])throw new TypeError("The first argument to Automerge.change must be the document root");if(e[d])throw new TypeError("Calls to Automerge.change cannot be nested");if("function"===typeof t&&void 0===n){var r=[n,t];t=r[0],n=r[1]}if("string"===typeof t&&(t={message:t}),void 0!==t&&!p(t))throw new TypeError("Unsupported type of options");var a=_(e);if(!a)throw new Error("Actor ID must be initialized with setActorId() before making a change");var o=new w(e,a);return n(I(o)),0===Object.keys(o.updated).length?[e,null]:S(e,o,t)}function _(e){return e[c].actorId||e[i].actorId}e.exports={init:B,from:function(e,t){return L(B(t),"Initialization",(function(t){return Object.assign(t,e)}))},change:L,emptyChange:function(e,t){if("_root"!==e[u])throw new TypeError("The first argument to Automerge.emptyChange must be the document root");if("string"===typeof t&&(t={message:t}),void 0!==t&&!p(t))throw new TypeError("Unsupported type of options");var n=_(e);if(!n)throw new Error("Actor ID must be initialized with setActorId() before making a change");return S(e,new w(e,n),t)},applyPatch:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if("_root"!==e[u])throw new TypeError("The first argument to Frontend.applyPatch must be the document root");var r,a=v(e[c]);if(e[i].backend){if(!n)throw new RangeError("applyPatch must be called with the updated backend state");return a.backendState=n,T(e,t,a,!0)}if(a.requests.length>0)if(r=a.requests[0].before,t.actor===_(e)){if(a.requests[0].seq!==t.seq)throw new RangeError("Mismatched sequence number: patch ".concat(t.seq," does not match next request ").concat(a.requests[0].seq));a.requests=a.requests.slice(1)}else a.requests=a.requests.slice();else r=e,a.requests=[];var o=T(r,t,a,!0);return 0===a.requests.length?o:(a.requests[0]=v(a.requests[0]),a.requests[0].before=o,N(e,{},a))},getObjectId:function(e){return e[u]},getObjectById:function(e,t){if(e[d])throw new TypeError("Cannot use getObjectById in a change callback");return e[s][t]},getActorId:_,setActorId:function(e,t){return R(t),N(e,{},Object.assign({},e[c],{actorId:t}))},getConflicts:function(e,t){if(e[l]&&e[l][t]&&Object.keys(e[l][t]).length>1)return e[l][t]},getLastLocalChange:function(e){return e[c]&&e[c].lastLocalChange?e[c].lastLocalChange:null},getBackendState:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"first";if("_root"!==e[u]){var r=Array.isArray(e)?". Note: Automerge.applyChanges now returns an array.":"";throw t?new TypeError("The ".concat(n," argument to Automerge.").concat(t," must be the document root").concat(r)):new TypeError("Argument is not an Automerge document root".concat(r))}return e[c].backendState},getElementIds:function(e){return e instanceof k?e.elems.map((function(e){return e.elemId})):e[h]},Text:k,Table:O,Counter:E,Observable:V,Float64:j,Int:A,Uint:C}},776:function(e,t,n){var r=n(3913).default,a=n(4575).default,o=r((function e(t){"use strict";if(a(this,e),!(Number.isInteger(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER))throw new RangeError("Value ".concat(t," cannot be a uint"));this.value=t,Object.freeze(this)})),i=r((function e(t){"use strict";if(a(this,e),!(Number.isInteger(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=0))throw new RangeError("Value ".concat(t," cannot be a uint"));this.value=t,Object.freeze(this)})),s=r((function e(t){"use strict";if(a(this,e),"number"!==typeof t)throw new RangeError("Value ".concat(t," cannot be a float64"));this.value=t||0,Object.freeze(this)}));e.exports={Int:o,Uint:i,Float64:s}},2647:function(e,t,n){var r=n(3269).default,a=n(4575).default,o=n(3913).default,i=n(5094),s=i.OBJECT_ID,c=i.CONFLICTS,u=function(){"use strict";function e(){a(this,e),this.observers={}}return o(e,[{key:"patchCallback",value:function(e,t,n,r,a){this._objectUpdate(e.diffs,t,n,r,a)}},{key:"_objectUpdate",value:function(e,t,n,a,o){if(e.objectId){if(this.observers[e.objectId]){var i,s=r(this.observers[e.objectId]);try{for(s.s();!(i=s.n()).done;){(0,i.value)(e,t,n,a,o)}}catch(V){s.e(V)}finally{s.f()}}if("map"===e.type&&e.props)for(var u=0,l=Object.keys(e.props);u<l.length;u++)for(var d=l[u],h=0,f=Object.keys(e.props[d]);h<f.length;h++){var p=f[h];this._objectUpdate(e.props[d][p],t&&t[c]&&t[c][d]&&t[c][d][p],n&&n[c]&&n[c][d]&&n[c][d][p],a,o)}else if("table"===e.type&&e.props)for(var v=0,y=Object.keys(e.props);v<y.length;v++)for(var g=y[v],b=0,m=Object.keys(e.props[g]);b<m.length;b++){var I=m[b];this._objectUpdate(e.props[g][I],t&&t.byId(g),n&&n.byId(g),a,o)}else if("list"===e.type&&e.edits){var w,k=0,O=r(e.edits);try{for(O.s();!(w=O.n()).done;){var E=w.value;"insert"===E.action?(k-=1,this._objectUpdate(E.value,void 0,n&&n[c]&&n[c][E.index]&&n[c][E.index][E.elemId],a,o)):"multi-insert"===E.action?k-=E.values.length:"update"===E.action?this._objectUpdate(E.value,t&&t[c]&&t[c][E.index+k]&&t[c][E.index+k][E.opId],n&&n[c]&&n[c][E.index]&&n[c][E.index][E.opId],a,o):"remove"===E.action&&(k+=E.count)}}catch(V){O.e(V)}finally{O.f()}}else if("text"===e.type&&e.edits){var x,j=0,A=r(e.edits);try{for(A.s();!(x=A.n()).done;){var C=x.value;"insert"===C.action?(j-=1,this._objectUpdate(C.value,void 0,n&&n.get(C.index),a,o)):"multi-insert"===C.action?j-=C.values.length:"update"===C.action?this._objectUpdate(C.value,t&&t.get(C.index+j),n&&n.get(C.index),a,o):"remove"===C.action&&(j+=C.count)}}catch(V){A.e(V)}finally{A.f()}}}}},{key:"observe",value:function(e,t){var n=e[s];if(!n)throw new TypeError("The observed object must be part of an Automerge document");this.observers[n]||(this.observers[n]=[]),this.observers[n].push(t)}}]),e}();e.exports={Observable:u}},7968:function(e,t,n){var r=n(3038).default,a=n(5094),o=a.OBJECT_ID,i=a.CHANGE,s=a.STATE,c=n(4443).createArrayOfNulls,u=n(4350).Text,l=n(6939).Table;function d(e){if("string"===typeof e&&/^[0-9]+$/.test(e)&&(e=parseInt(e,10)),"number"!==typeof e)throw new TypeError("A list index must be a number, but you passed "+JSON.stringify(e));if(e<0||isNaN(e)||e===1/0||e===-1/0)throw new RangeError("A list index must be positive, but you passed "+e);return e}var h={get:function(e,t){var n=e.context,r=e.objectId,a=e.path;return t===o?r:t===i?n:t===s?{actorId:n.actorId}:n.getObjectField(a,r,t)},set:function(e,t,n){var r=e.context,a=e.path,o=e.readonly;if(Array.isArray(o)&&o.indexOf(t)>=0)throw new RangeError('Object property "'.concat(t,'" cannot be modified'));return r.setMapKey(a,t,n),!0},deleteProperty:function(e,t){var n=e.context,r=e.path,a=e.readonly;if(Array.isArray(a)&&a.indexOf(t)>=0)throw new RangeError('Object property "'.concat(t,'" cannot be modified'));return n.deleteMapKey(r,t),!0},has:function(e,t){var n=e.context,r=e.objectId;return[o,i].includes(t)||t in n.getObject(r)},getOwnPropertyDescriptor:function(e,t){var n=e.context,r=e.objectId;if(t in n.getObject(r))return{configurable:!0,enumerable:!0,value:n.getObjectField(r,t)}},ownKeys:function(e){var t=e.context,n=e.objectId;return Object.keys(t.getObject(n))}},f={get:function(e,t){var n=r(e,3),a=n[0],s=n[1],c=n[2];return t===Symbol.iterator?a.getObject(s)[Symbol.iterator]:t===o?s:t===i?a:"length"===t?a.getObject(s).length:"string"===typeof t&&/^[0-9]+$/.test(t)?a.getObjectField(c,s,d(t)):function(e,t,n){for(var r={deleteAt:function(t,r){return e.splice(n,d(t),r||1,[]),this},fill:function(r,a,o){for(var i=e.getObject(t),s=d(a||0);s<d(o||i.length);s++)e.setListIndex(n,s,r);return this},indexOf:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=n[o];if(a){for(var i=e.getObject(t),s=r;s<i.length;s++)if(i[s][o]===a)return s;return-1}return e.getObject(t).indexOf(n,r)},insertAt:function(t){for(var r=arguments.length,a=new Array(r>1?r-1:0),o=1;o<r;o++)a[o-1]=arguments[o];return e.splice(n,d(t),0,a),this},pop:function(){var r=e.getObject(t);if(0!=r.length){var a=e.getObjectField(n,t,r.length-1);return e.splice(n,r.length-1,1,[]),a}},push:function(){for(var r=e.getObject(t),a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return e.splice(n,r.length,0,o),e.getObject(t).length},shift:function(){if(0!=e.getObject(t).length){var r=e.getObjectField(n,t,0);return e.splice(n,0,1,[]),r}},splice:function(r,a){var o=e.getObject(t);r=d(r),(void 0===a||a>o.length-r)&&(a=o.length-r);for(var i=[],s=0;s<a;s++)i.push(e.getObjectField(n,t,r+s));for(var c=arguments.length,u=new Array(c>2?c-2:0),l=2;l<c;l++)u[l-2]=arguments[l];return e.splice(n,r,a,u),i},unshift:function(){for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return e.splice(n,0,0,a),e.getObject(t).length}},a=function(){var n=s[i],a=e.getObject(t);r[n]=function(){return a[n]()}},i=0,s=["entries","keys","values"];i<s.length;i++)a();for(var c=function(){var a=l[u];r[a]=function(){var r=e.getObject(t).map((function(r,a){return e.getObjectField(n,t,a)}));return r[a].apply(r,arguments)}},u=0,l=["concat","every","filter","find","findIndex","forEach","includes","join","lastIndexOf","map","reduce","reduceRight","slice","some","toLocaleString","toString"];u<l.length;u++)c();return r}(a,s,c)[t]},set:function(e,t,n){var a=r(e,3),o=a[0],i=a[1],s=a[2];if("length"===t){if("number"!==typeof n)throw new RangeError("Invalid array length");var u=o.getObject(i).length;u>n?o.splice(s,n,u-n,[]):o.splice(s,u,0,c(n-u))}else o.setListIndex(s,d(t),n);return!0},deleteProperty:function(e,t){var n=r(e,3),a=n[0],o=n[2];return a.splice(o,d(t),1,[]),!0},has:function(e,t){var n=r(e,2),a=n[0],s=n[1];return"string"===typeof t&&/^[0-9]+$/.test(t)?d(t)<a.getObject(s).length:["length",o,i].includes(t)},getOwnPropertyDescriptor:function(e,t){var n=r(e,2),a=n[0],i=n[1],s=a.getObject(i);if("length"===t)return{writable:!0,value:s.length};if(t===o)return{configurable:!1,enumerable:!1,value:i};if("string"===typeof t&&/^[0-9]+$/.test(t)){var c=d(t);if(c<s.length)return{configurable:!0,enumerable:!0,value:a.getObjectField(i,c)}}},ownKeys:function(e){for(var t=r(e,2),n=t[0],a=t[1],o=n.getObject(a),i=["length"],s=0,c=Object.keys(o);s<c.length;s++){var u=c[s];i.push(u)}return i}};function p(e,t,n,r){return new Proxy({context:e,objectId:t,path:n,readonly:r},h)}function v(e,t,n){var r=this.getObject(t);return Array.isArray(r)?function(e,t,n){return new Proxy([e,t,n],f)}(this,t,e):r instanceof u||r instanceof l?r.getWriteable(this,e):p(this,t,e,n)}e.exports={rootObjectProxy:function(e){return e.instantiateObject=v,p(e,"_root",[])}}},6939:function(e,t,n){var r=n(2205).default,a=n(9842).default,o=n(4575).default,i=n(3913).default,s=n(3269).default,c=n(5094),u=c.OBJECT_ID,l=c.CONFLICTS,d=n(4443),h=d.isObject,f=d.copyObject;function p(e,t,n){var r,a=s(e);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(t[o]!==n[o]){if("number"===typeof t[o]&&"number"===typeof n[o])return t[o]-n[o];var i=""+t[o],c=""+n[o];if(i!==c)return i<c?-1:1}}}catch(u){a.e(u)}finally{a.f()}return 0}var v=function(e){"use strict";function t(){o(this,t),this.entries=Object.freeze({}),this.opIds=Object.freeze({}),Object.freeze(this)}return i(t,[{key:"byId",value:function(e){return this.entries[e]}},{key:"ids",get:function(){var e=this;return Object.keys(this.entries).filter((function(t){var n=e.entries[t];return h(n)&&n.id===t}))}},{key:"count",get:function(){return this.ids.length}},{key:"rows",get:function(){var e=this;return this.ids.map((function(t){return e.byId(t)}))}},{key:"filter",value:function(e,t){return this.rows.filter(e,t)}},{key:"find",value:function(e,t){return this.rows.find(e,t)}},{key:"map",value:function(e,t){return this.rows.map(e,t)}},{key:"sort",value:function(e){if("function"===typeof e)return this.rows.sort(e);if("string"===typeof e)return this.rows.sort((function(t,n){return p([e],t,n)}));if(Array.isArray(e))return this.rows.sort((function(t,n){return p(e,t,n)}));if(void 0===e)return this.rows.sort((function(e,t){return p(["id"],e,t)}));throw new TypeError("Unsupported sorting argument: ".concat(e))}},{key:e,value:function(){var e=this.rows,t=-1;return{next:function(){return(t+=1)<e.length?{done:!1,value:e[t]}:{done:!0}}}}},{key:"_clone",value:function(){if(!this[u])throw new RangeError("clone() requires the objectId to be set");return g(this[u],f(this.entries),f(this.opIds))}},{key:"_set",value:function(e,t,n){if(Object.isFrozen(this.entries))throw new Error("A table can only be modified in a change function");h(t)&&!Array.isArray(t)&&Object.defineProperty(t,"id",{value:e,enumerable:!0}),this.entries[e]=t,this.opIds[e]=n}},{key:"remove",value:function(e){if(Object.isFrozen(this.entries))throw new Error("A table can only be modified in a change function");delete this.entries[e],delete this.opIds[e]}},{key:"_freeze",value:function(){Object.freeze(this.entries),Object.freeze(this.opIds),Object.freeze(this)}},{key:"getWriteable",value:function(e,t){if(!this[u])throw new RangeError("getWriteable() requires the objectId to be set");var n=Object.create(y.prototype);return n[u]=this[u],n.context=e,n.entries=this.entries,n.opIds=this.opIds,n.path=t,n}},{key:"toJSON",value:function(){var e,t={},n=s(this.ids);try{for(n.s();!(e=n.n()).done;){var r=e.value;t[r]=this.byId(r)}}catch(a){n.e(a)}finally{n.f()}return t}}]),t}(Symbol.iterator),y=function(e){"use strict";r(n,e);var t=a(n);function n(){return o(this,n),t.apply(this,arguments)}return i(n,[{key:"byId",value:function(e){if(h(this.entries[e])&&this.entries[e].id===e){var t=this.entries[e][u],n=this.path.concat([{key:e,objectId:t}]);return this.context.instantiateObject(n,t,["id"])}}},{key:"add",value:function(e){return this.context.addTableRow(this.path,e)}},{key:"remove",value:function(e){if(!h(this.entries[e])||this.entries[e].id!==e)throw new RangeError("There is no row with ID ".concat(e," in this table"));this.context.deleteTableRow(this.path,e,this.opIds[e])}}]),n}(v);function g(e,t,n){var r=Object.create(v.prototype);if(!e)throw new RangeError("instantiateTable requires an objectId to be given");return r[u]=e,r[l]=Object.freeze({}),r.entries=t||{},r.opIds=n||{},r}e.exports={Table:v,instantiateTable:g}},4350:function(e,t,n){for(var r=n(3269).default,a=n(319).default,o=n(4575).default,i=n(3913).default,s=n(5094).OBJECT_ID,c=n(4443).isObject,u=function(e){"use strict";function t(e){if(o(this,t),"string"===typeof e)return f(void 0,a(e).map((function(e){return{value:e}})));if(Array.isArray(e))return f(void 0,e.map((function(e){return{value:e}})));if(void 0===e)return f(void 0,[]);throw new TypeError("Unsupported initial value for Text: ".concat(e))}return i(t,[{key:"length",get:function(){return this.elems.length}},{key:"get",value:function(e){var t=this.elems[e].value;if(this.context&&c(t)){var n=t[s],r=this.path.concat([{key:e,objectId:n}]);return this.context.instantiateObject(r,n)}return t}},{key:"getElemId",value:function(e){return this.elems[e].elemId}},{key:e,value:function(){var e=this.elems,t=-1;return{next:function(){return(t+=1)<e.length?{done:!1,value:e[t].value}:{done:!0}}}}},{key:"toString",value:function(){var e,t="",n=r(this.elems);try{for(n.s();!(e=n.n()).done;){var a=e.value;"string"===typeof a.value&&(t+=a.value)}}catch(o){n.e(o)}finally{n.f()}return t}},{key:"toSpans",value:function(){var e,t=[],n="",a=r(this.elems);try{for(a.s();!(e=a.n()).done;){var o=e.value;"string"===typeof o.value?n+=o.value:(n.length>0&&(t.push(n),n=""),t.push(o.value))}}catch(i){a.e(i)}finally{a.f()}return n.length>0&&t.push(n),t}},{key:"toJSON",value:function(){return this.toString()}},{key:"getWriteable",value:function(e,t){if(!this[s])throw new RangeError("getWriteable() requires the objectId to be set");var n=f(this[s],this.elems);return n.context=e,n.path=t,n}},{key:"set",value:function(e,t){if(this.context)this.context.setListIndex(this.path,e,t);else{if(this[s])throw new TypeError("Automerge.Text object cannot be modified outside of a change block");this.elems[e].value=t}return this}},{key:"insertAt",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(this.context)this.context.splice(this.path,e,0,n);else{if(this[s])throw new TypeError("Automerge.Text object cannot be modified outside of a change block");var o;(o=this.elems).splice.apply(o,[e,0].concat(a(n.map((function(e){return{value:e}})))))}return this}},{key:"deleteAt",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(this.context)this.context.splice(this.path,e,t,[]);else{if(this[s])throw new TypeError("Automerge.Text object cannot be modified outside of a change block");this.elems.splice(e,t)}return this}}]),t}(Symbol.iterator),l=function(){var e=h[d];u.prototype[e]=function(){var t=a(this);return t[e].apply(t,arguments)}},d=0,h=["concat","every","filter","find","findIndex","forEach","includes","indexOf","join","lastIndexOf","map","reduce","reduceRight","slice","some","toLocaleString"];d<h.length;d++)l();function f(e,t){var n=Object.create(u.prototype);return n[s]=e,n.elems=t,n}e.exports={Text:u,instantiateText:f}},866:function(e,t,n){var r=n(3038).default,a=n(9860),o=n(2125),i=n(5094).OPTIONS,s=n(8504),c=s.encodeChange,u=s.decodeChange,l=n(4443).isObject,d=n(5871);function h(e){if("string"===typeof e)e={actorId:e};else if("undefined"===typeof e)e={};else if(!l(e))throw new TypeError("Unsupported options for init(): ".concat(e));return o.init(Object.assign({backend:d},e))}function f(e,t,n){var a=o.change(e,t,n);return r(a,1)[0]}function p(e){return d.getAllChanges(o.getBackendState(e,"getAllChanges"))}function v(e,t,n,r,a){var s=o.applyPatch(e,t,n),c=a.patchCallback||e[i].patchCallback;return c&&c(t,e,s,!1,r),s}function y(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=o.getBackendState(e,"applyChanges"),i=d.applyChanges(a,t),s=r(i,2),c=s[0],u=s[1];return[v(e,u,c,t,n),u]}e.exports={init:h,from:function(e,t){return f(h(t),{message:"Initialization"},(function(t){return Object.assign(t,e)}))},change:f,emptyChange:function(e,t){var n=o.emptyChange(e,t);return r(n,1)[0]},clone:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=d.clone(o.getBackendState(e,"clone"));return v(h(t),d.getPatch(n),n,[],t)},free:function(e){d.free(o.getBackendState(e,"free"))},load:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=d.load(e);return v(h(t),d.getPatch(n),n,[e],t)},save:function(e){return d.save(o.getBackendState(e,"save"))},merge:function(e,t){var n=o.getBackendState(e,"merge"),a=o.getBackendState(t,"merge","second"),i=y(e,d.getChangesAdded(n,a));return r(i,1)[0]},getChanges:function(e,t){var n=o.getBackendState(e,"getChanges"),r=o.getBackendState(t,"getChanges","second");return d.getChanges(r,d.getHeads(n))},getAllChanges:p,applyChanges:y,encodeChange:c,decodeChange:u,equals:function e(t,n){if(!l(t)||!l(n))return t===n;var r=Object.keys(t).sort(),a=Object.keys(n).sort();if(r.length!==a.length)return!1;for(var o=0;o<r.length;o++){if(r[o]!==a[o])return!1;if(!e(t[r[o]],n[a[o]]))return!1}return!0},getHistory:function(e){var t=o.getActorId(e),n=p(e);return n.map((function(e,r){return{get change(){return u(e)},get snapshot(){var e=d.loadChanges(d.init(),n.slice(0,r+1));return o.applyPatch(h(t),d.getPatch(e),e)}}}))},uuid:a,Frontend:o,setDefaultBackend:function(e){d=e},generateSyncMessage:function(e,t){var n=o.getBackendState(e,"generateSyncMessage");return d.generateSyncMessage(n,t)},receiveSyncMessage:function(e,t,n){var a=o.getBackendState(e,"receiveSyncMessage"),s=d.receiveSyncMessage(a,t,n),c=r(s,3),u=c[0],l=c[1],h=c[2];if(!h)return[e,l,h];var f=null;return e[i].patchCallback&&(f=d.decodeSyncMessage(n).changes),[v(e,h,u,f,{}),l,h]},initSyncState:function(){return d.initSyncState()},get Backend(){return d}};for(var g=0,b=["getObjectId","getObjectById","getActorId","setActorId","getConflicts","getLastLocalChange","Text","Table","Counter","Observable","Int","Uint","Float64"];g<b.length;g++){var m=b[g];e.exports[m]=o[m]}},4443:function(e){function t(e){return"object"===typeof e&&null!==e}e.exports={isObject:t,copyObject:function(e){if(!t(e))return{};for(var n={},r=0,a=Object.keys(e);r<a.length;r++){var o=a[r];n[o]=e[o]}return n},parseOpId:function(e){var t=/^(\d+)@(.*)$/.exec(e||"");if(!t)throw new RangeError("Not a valid opId: ".concat(e));return{counter:parseInt(t[1],10),actorId:t[2]}},equalBytes:function(e,t){if(!(e instanceof Uint8Array)||!(t instanceof Uint8Array))throw new TypeError("equalBytes can only compare Uint8Arrays");if(e.byteLength!==t.byteLength)return!1;for(var n=0;n<e.byteLength;n++)if(e[n]!==t[n])return!1;return!0},createArrayOfNulls:function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=null;return t}}},9860:function(e,t,n){var r=n(621).v4;function a(){return r().replace(/-/g,"")}var o=a;function i(){return o()}i.setFactory=function(e){o=e},i.reset=function(){o=a},e.exports=i}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,n),o.exports}n.m=e,n.x=function(){var e=n.O(void 0,[459],(function(){return n(5601)}));return e=n.O(e)},function(){var e=[];n.O=function(t,r,a,o){if(!r){var i=1/0;for(l=0;l<e.length;l++){r=e[l][0],a=e[l][1],o=e[l][2];for(var s=!0,c=0;c<r.length;c++)(!1&o||i>=o)&&Object.keys(n.O).every((function(e){return n.O[e](r[c])}))?r.splice(c--,1):(s=!1,o<i&&(i=o));if(s){e.splice(l--,1);var u=a();void 0!==u&&(t=u)}}return t}o=o||0;for(var l=e.length;l>0&&e[l-1][2]>o;l--)e[l]=e[l-1];e[l]=[r,a,o]}}(),n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce((function(t,r){return n.f[r](e,t),t}),[]))},n.u=function(e){return"static/js/"+e+".d99306ff.chunk.js"},n.miniCssF=function(e){},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",function(){var e={601:1};n.f.i=function(t,r){e[t]||importScripts(n.p+n.u(t))};var t=self.webpackChunkautowiki=self.webpackChunkautowiki||[],r=t.push.bind(t);t.push=function(t){var a=t[0],o=t[1],i=t[2];for(var s in o)n.o(o,s)&&(n.m[s]=o[s]);for(i&&i(n);a.length;)e[a.pop()]=1;r(t)}}(),function(){var e=n.x;n.x=function(){return n.e(459).then(e)}}();n.x()}();
//# sourceMappingURL=601.e7121f4e.chunk.js.map